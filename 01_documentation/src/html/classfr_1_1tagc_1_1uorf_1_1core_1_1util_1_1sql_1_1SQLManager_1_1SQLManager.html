<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sORFdatafreezer: fr.tagc.uorf.core.util.sql.SQLManager.SQLManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sORFdatafreezer
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>fr</b></li><li class="navelem"><b>tagc</b></li><li class="navelem"><b>uorf</b></li><li class="navelem"><b>core</b></li><li class="navelem"><b>util</b></li><li class="navelem"><b>sql</b></li><li class="navelem"><b>SQLManager</b></li><li class="navelem"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html">SQLManager</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">fr.tagc.uorf.core.util.sql.SQLManager.SQLManager Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for fr.tagc.uorf.core.util.sql.SQLManager.SQLManager:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.png" usemap="#fr.tagc.uorf.core.util.sql.SQLManager.SQLManager_map" alt=""/>
  <map id="fr.tagc.uorf.core.util.sql.SQLManager.SQLManager_map" name="fr.tagc.uorf.core.util.sql.SQLManager.SQLManager_map">
<area href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManagerDS_1_1SQLManagerDS.html" alt="fr.tagc.uorf.core.util.sql.SQLManagerDS.SQLManagerDS" shape="rect" coords="0,56,357,80"/>
<area href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManagerFILT_1_1SQLManagerFILT.html" alt="fr.tagc.uorf.core.util.sql.SQLManagerFILT.SQLManagerFILT" shape="rect" coords="367,56,724,80"/>
<area href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManagerPRO_1_1SQLManagerPRO.html" alt="fr.tagc.uorf.core.util.sql.SQLManagerPRO.SQLManagerPRO" shape="rect" coords="734,56,1091,80"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae203c46cb6ac42883f8d4d1346168312"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#ae203c46cb6ac42883f8d4d1346168312">__init__</a> (self)</td></tr>
<tr class="separator:ae203c46cb6ac42883f8d4d1346168312"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ce4a10aa6357215b3c62f93b37a80ce"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a2ce4a10aa6357215b3c62f93b37a80ce">set_db_settings</a> (self, db_settings)</td></tr>
<tr class="separator:a2ce4a10aa6357215b3c62f93b37a80ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1d6812a8a313773d0a6da882560932f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#aa1d6812a8a313773d0a6da882560932f">create_db_url</a> (self)</td></tr>
<tr class="separator:aa1d6812a8a313773d0a6da882560932f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c28f3b363cc8755f26f0666fc60545f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a5c28f3b363cc8755f26f0666fc60545f">build_database</a> (self, db_settings, species, sp_mandatory=True, force_overwrite=False)</td></tr>
<tr class="separator:a5c28f3b363cc8755f26f0666fc60545f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d01e836a891c6204148ebab7eb21d0b"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a3d01e836a891c6204148ebab7eb21d0b">build_sqlite_database</a> (self, force_overwrite)</td></tr>
<tr class="separator:a3d01e836a891c6204148ebab7eb21d0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82d8caf36f15ee6653fae8318849d7b6"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a82d8caf36f15ee6653fae8318849d7b6">remove_sqlite_db</a> (self)</td></tr>
<tr class="separator:a82d8caf36f15ee6653fae8318849d7b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9383486d689190b0ea4cfa3b50bccd1"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#ae9383486d689190b0ea4cfa3b50bccd1">build_mysql_database</a> (self, force_overwrite)</td></tr>
<tr class="separator:ae9383486d689190b0ea4cfa3b50bccd1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb8f49f723b9f4aee02c1a8d073c8f3d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#abb8f49f723b9f4aee02c1a8d073c8f3d">check_database_str_integrity</a> (self)</td></tr>
<tr class="separator:abb8f49f723b9f4aee02c1a8d073c8f3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ea29a524e66e1718dda6af31b4f6ba3"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a2ea29a524e66e1718dda6af31b4f6ba3">get_session</a> (self)</td></tr>
<tr class="separator:a2ea29a524e66e1718dda6af31b4f6ba3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f32a81a8b5f6bcbe44eab986c144dc5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a3f32a81a8b5f6bcbe44eab986c144dc5">create_session</a> (self)</td></tr>
<tr class="separator:a3f32a81a8b5f6bcbe44eab986c144dc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4aa87a547b45ff0857f9367065e9411"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#ac4aa87a547b45ff0857f9367065e9411">close_session</a> (self)</td></tr>
<tr class="separator:ac4aa87a547b45ff0857f9367065e9411"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a783dbcbdfedc5ae5109e67dddbaf8f73"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a783dbcbdfedc5ae5109e67dddbaf8f73">session_exists</a> (self)</td></tr>
<tr class="separator:a783dbcbdfedc5ae5109e67dddbaf8f73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23abb895a9c87afd769ba4bdcc51905f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a23abb895a9c87afd769ba4bdcc51905f">commit</a> (self)</td></tr>
<tr class="separator:a23abb895a9c87afd769ba4bdcc51905f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f776a82f32614882d5aa4c323366692"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a7f776a82f32614882d5aa4c323366692">rollback_session</a> (self)</td></tr>
<tr class="separator:a7f776a82f32614882d5aa4c323366692"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26739db944f13d96a3f37a4aa8583580"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a26739db944f13d96a3f37a4aa8583580">get_engine</a> (self)</td></tr>
<tr class="separator:a26739db944f13d96a3f37a4aa8583580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa3e2d9510429ba9643d224930ee64eb"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#aaa3e2d9510429ba9643d224930ee64eb">create_engine</a> (self)</td></tr>
<tr class="separator:aaa3e2d9510429ba9643d224930ee64eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9c62ac9da213140e8b575b2a0615d31"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#ac9c62ac9da213140e8b575b2a0615d31">db_exists</a> (self)</td></tr>
<tr class="separator:ac9c62ac9da213140e8b575b2a0615d31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee08d3b71842bcf84dacbcfeb385874f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#aee08d3b71842bcf84dacbcfeb385874f">get_db_name</a> (self)</td></tr>
<tr class="separator:aee08d3b71842bcf84dacbcfeb385874f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a544448c4284b03097b2f474080a66fc6"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a544448c4284b03097b2f474080a66fc6">get_declarative_base</a> (self)</td></tr>
<tr class="separator:a544448c4284b03097b2f474080a66fc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a2d21aca48b78e5f647ba54fe43a38a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a7a2d21aca48b78e5f647ba54fe43a38a">batch_insert_to_db</a> (self, objects_to_insert, process='Undefined process')</td></tr>
<tr class="separator:a7a2d21aca48b78e5f647ba54fe43a38a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a314d1c7a8139ad13e36670aad12b4660"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#a314d1c7a8139ad13e36670aad12b4660">add_and_commit</a> (self, objects_to_add, process='Undefined process')</td></tr>
<tr class="separator:a314d1c7a8139ad13e36670aad12b4660"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa506c5bda1a80555689e6bb9a3082f50"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html#aa506c5bda1a80555689e6bb9a3082f50">add_and_flush</a> (self, objects_to_add, process='Undefined process')</td></tr>
<tr class="separator:aa506c5bda1a80555689e6bb9a3082f50"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html">SQLManager</a> </h1>
<p>This class is an abstract class and metaclass of singletons aiming to manage SQL connection to the databases. The singletons inheriting from this class are able to manage the creation of a SQLAlchemy sessions to the database it has been initiated with. The singletons handle one single engine and one single session opened at a time until it is explicitly asked to close it. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ae203c46cb6ac42883f8d4d1346168312"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae203c46cb6ac42883f8d4d1346168312">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>Constructor of <a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html">SQLManager</a> </h2>
<p>Instance variable:</p><ul>
<li>db_type: String - The database type (SQLite or MySQL).</li>
<li>db_name: String - The database name.</li>
<li>db_settings: Dictionary - A dictionary of settings. This may include:<ul>
<li>The database name (required).</li>
<li>The database type (SQLite / MySQL) (optional).</li>
<li>For SQLite databases: the folder of SQLite file (optional).</li>
<li>For MySQL databases: the MySQL user, password, host IP and port (optional).</li>
</ul>
</li>
<li>db_uri: String - The URI to the database.</li>
<li>db_url: String - The URL to the database.</li>
<li>dbpath: String - The path to the database or the name of the database: For SQLite databases, the absolute path to the database. For MySQL databases, the name of the database.</li>
<li>session: Session - A SQLAlchemy Session instance allowing to maintain the conversation between Python and the database.</li>
<li>engine: Engine - A SQLAlchemy Engine instance allowing the connection to the database.</li>
<li>classname: The name of the current class (used for logs). </li>
</ul>

<p>Reimplemented in <a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManagerFILT_1_1SQLManagerFILT.html#a9cbd4a0deb6344e0fb32ff5f6f0c47f9">fr.tagc.uorf.core.util.sql.SQLManagerFILT.SQLManagerFILT</a>, <a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManagerDS_1_1SQLManagerDS.html#a30319f98b38f5d1cf08ae4b8daa91d7d">fr.tagc.uorf.core.util.sql.SQLManagerDS.SQLManagerDS</a>, and <a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManagerPRO_1_1SQLManagerPRO.html#ad48e0f11a977dddb0c5c7cb3066784b2">fr.tagc.uorf.core.util.sql.SQLManagerPRO.SQLManagerPRO</a>.</p>
<div class="fragment"><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keyword">def </span>__init__( self ):</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        self.db_type = <span class="keywordtype">None</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        self.db_name = <span class="keywordtype">None</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        self.db_settings = <span class="keywordtype">None</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        self.db_uri = <span class="keywordtype">None</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        self.db_url = <span class="keywordtype">None</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        self.db_path = <span class="keywordtype">None</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        self.session = <span class="keywordtype">None</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        self.engine = <span class="keywordtype">None</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        </div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        self.classname = str( self.__class__.__name__ )</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                </div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                </div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a314d1c7a8139ad13e36670aad12b4660"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a314d1c7a8139ad13e36670aad12b4660">&#9670;&nbsp;</a></span>add_and_commit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.add_and_commit </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>objects_to_add</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>process</em> = <code>'Undefined&#160;process'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>add_and_commit </h2>
<p>This method allows to add objects to the session and commit the session right after. NB: This method DO NOT close the session after the addition of the objects.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">objects_to_add</td><td>List - The list of DenCellORF objects (classes defined in the model module) to insert in the database. </td></tr>
    <tr><td class="paramname">process</td><td>String - The name of the process that generated the list. 'Undefined process' by default.</td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When an exception is raised during the addition of objects to the database. </td></tr>
    <tr><td class="paramname">DenCellORFException</td><td>When an exception is raised during the commit of the session. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keyword">def </span>add_and_commit( self, objects_to_add, process=&#39;Undefined process&#39; ):</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        </div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="comment"># Get the number of objects that are expected to be inserted in the database</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        total_count = len( objects_to_add )</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        </div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="comment"># Add the objects to the session</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            self.get_session().add_all( objects_to_add )</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <span class="comment"># Get the number of objects of each type in the list</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            types_dict = GeneralUtil.get_type_counts_in_list( objects_to_add )</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            types_dict_str = <span class="stringliteral">&#39;, &#39;</span>.join( [ str( tp ) + <span class="stringliteral">&#39;: &#39;</span> + str( val ) <span class="keywordflow">for</span> ( tp, val ) <span class="keywordflow">in</span> types_dict.items() ] )</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            </div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + <span class="stringliteral">&#39;.add_and_commit():&#39;</span> +</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                                       <span class="stringliteral">&#39; An error occurred trying to add &#39;</span> + str( total_count ) +</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                       <span class="stringliteral">&#39; objects (from &#39;</span> + process  + <span class="stringliteral">&#39;) to the session.&#39;</span> +</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                       <span class="stringliteral">&#39; The list was containing the following objects: &#39;</span> + </div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                                       types_dict_str + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        </div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <span class="comment"># Commit changes</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            self.commit()</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            <span class="comment"># Get the number of objects of each type in the list</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            types_dict = GeneralUtil.get_type_counts_in_list( objects_to_add )</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            types_dict_str = <span class="stringliteral">&#39;, &#39;</span>.join( [ str( tp ) + <span class="stringliteral">&#39;: &#39;</span> + str( val ) <span class="keywordflow">for</span> ( tp, val ) <span class="keywordflow">in</span> types_dict.items() ] )</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            </div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + <span class="stringliteral">&#39;.add_and_commit():&#39;</span> +</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                                       <span class="stringliteral">&#39; An error occurred trying to commit changes after addition of &#39;</span> +</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                                       str( total_count ) + <span class="stringliteral">&#39; objects (from &#39;</span> + process + <span class="stringliteral">&#39;) to the session.&#39;</span> +</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                                       <span class="stringliteral">&#39; The list was containing the following objects: &#39;</span> + </div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                                       types_dict_str + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            </div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="comment"># Log in debug mode the number of objects successfully inserted</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        Logger.get_instance().debug( self.classname + <span class="stringliteral">&#39;.add_and_commit(): &#39;</span> + </div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                                     str( total_count ) + <span class="stringliteral">&#39; objects (from &#39;</span> + process + </div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                                     <span class="stringliteral">&#39;) have been successfully added to the database.&#39;</span> )</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="aa506c5bda1a80555689e6bb9a3082f50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa506c5bda1a80555689e6bb9a3082f50">&#9670;&nbsp;</a></span>add_and_flush()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.add_and_flush </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>objects_to_add</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>process</em> = <code>'Undefined&#160;process'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>add_and_flush </h2>
<p>This method allows to add objects to the session and flush the session right after (WITHOUT COMMITTING). NB: This method DO NOT commit the session and obviously DO NOT close the session after the addition of the objects.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">objects_to_add</td><td>List - The list of DenCellORF objects (classes defined in the model module) to insert in the database. </td></tr>
    <tr><td class="paramname">process</td><td>String - The name of the process that generated the list. 'Undefined process' by default.</td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When an exception is raised during the addition of objects to the database. </td></tr>
    <tr><td class="paramname">DenCellORFException</td><td>When an exception is raised trying to flush the session. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keyword">def </span>add_and_flush( self, objects_to_add, process=&#39;Undefined process&#39; ):</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        </div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="comment"># Add the objects to the session</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            self.get_session().add_all( objects_to_add )</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            <span class="comment"># Get the number of objects of each type in the list</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            types_dict = GeneralUtil.get_type_counts_in_list( objects_to_add )</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            types_dict_str = <span class="stringliteral">&#39;, &#39;</span>.join( [ str( tp ) + <span class="stringliteral">&#39;: &#39;</span> + str( val ) <span class="keywordflow">for</span> ( tp, val ) <span class="keywordflow">in</span> types_dict.items() ] )</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            </div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + <span class="stringliteral">&#39;.add_and_flush(): &#39;</span> + </div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                                       <span class="stringliteral">&#39; An error occurred trying to add &#39;</span> + str( total_count ) + </div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                                       <span class="stringliteral">&#39; objects (from &#39;</span> + process + <span class="stringliteral">&#39;) to the session.&#39;</span> +</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                       <span class="stringliteral">&#39; The list was containing the following objects: &#39;</span> + </div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                                       types_dict_str + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        </div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="comment"># Flush changes</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            self.get_session().flush()</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            <span class="comment"># Get the number of objects of each type in the list</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            types_dict = GeneralUtil.get_type_counts_in_list( objects_to_add )</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            types_dict_str = <span class="stringliteral">&#39;, &#39;</span>.join( [ str( tp ) + <span class="stringliteral">&#39;: &#39;</span> + str( val ) <span class="keywordflow">for</span> ( tp, val ) <span class="keywordflow">in</span> types_dict.items() ] )</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            </div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + <span class="stringliteral">&#39;.add_and_flush():&#39;</span> +</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                       <span class="stringliteral">&#39; An error occurred trying to flush the session after addition of &#39;</span> + </div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                                       str( total_count ) + <span class="stringliteral">&#39; objects (from &#39;</span> + process + <span class="stringliteral">&#39;) to it.&#39;</span> +</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                                       <span class="stringliteral">&#39; The list was containing the following objects: &#39;</span> + </div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                                       types_dict_str + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            </div></div><!-- fragment -->
</div>
</div>
<a id="a7a2d21aca48b78e5f647ba54fe43a38a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a2d21aca48b78e5f647ba54fe43a38a">&#9670;&nbsp;</a></span>batch_insert_to_db()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.batch_insert_to_db </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>objects_to_insert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>process</em> = <code>'Undefined&#160;process'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>batch_insert_to_db </h2>
<p>This method allows to insert a list of objects in the database. Large sets of objects are first split into several batches which are inserted one at a time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">objects_to_insert</td><td>List - The list of DenCellORF objects (classes defined in the model module) to insert in the database. </td></tr>
    <tr><td class="paramname">process</td><td>String - The name of the process that generated this list. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keyword">def </span>batch_insert_to_db( self, objects_to_insert, process=&#39;Undefined process&#39; ):</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        </div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="comment"># Report the state of the session prior to data insertion</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        Logger.get_instance().debug( self.classname + <span class="stringliteral">&#39;.batch_insert_to_db(): A SQL session is currently&#39;</span> +</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                                     <span class="stringliteral">&#39; opened (prior to insertion of data from &#39;</span> + process + <span class="stringliteral">&#39;): &#39;</span> +</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                                     str( self.session_exists() ) + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        </div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">if</span> objects_to_insert:</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            total_count = len( objects_to_insert )</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        </div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="comment"># Insert objects into the database</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">if</span> ( objects_to_insert <span class="keywordflow">and</span> ( total_count &gt; 0 ) ):</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            </div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="comment"># Get the number of objects of each type in the list</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            types_dict = GeneralUtil.get_type_counts_in_list( objects_to_insert )</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            types_dict_str = <span class="stringliteral">&#39;, &#39;</span>.join( [ str( tp ) + <span class="stringliteral">&#39;: &#39;</span> + str( val ) <span class="keywordflow">for</span> ( tp, val ) <span class="keywordflow">in</span> types_dict.items() ] )</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;            </div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="comment"># Log in debug mode the count of objects expected to be inserted</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            Logger.get_instance().debug( self.classname + <span class="stringliteral">&#39;.batch_insert_to_db(): &#39;</span> + </div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                         str( total_count ) + <span class="stringliteral">&#39; objects (&#39;</span> + types_dict_str +</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                         <span class="stringliteral">&#39;, from &#39;</span> + process + <span class="stringliteral">&#39;) are expected to be added to the database.&#39;</span> )</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            </div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <span class="comment"># If the set of objects is small enough, add them directly to the database</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="keywordflow">if</span> ( total_count &lt; Constants.MAX_COUNT_TO_INSERT ):</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                self.add_and_commit( objects_to_add = objects_to_insert, </div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                                     process = process )</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                self.close_session()    </div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                </div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            </div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <span class="comment"># Otherwise, split the list of objects to insert into several smaller batches</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            <span class="comment"># and insert them into the database one at a time</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                <span class="comment"># Define the minimal index of the list of objects to insert</span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                min_bound = 0</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                </div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                <span class="keywordflow">while</span> ( min_bound &lt; len( objects_to_insert ) ):</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                    </div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                    <span class="keywordflow">if</span> ( min_bound + Constants.MAX_COUNT_TO_INSERT ) &lt;= len( objects_to_insert ):</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                        max_bound = min_bound + Constants.MAX_COUNT_TO_INSERT</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                        max_bound = len( objects_to_insert )</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                        </div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    <span class="comment"># Insert objects into the database</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                    self.add_and_commit( objects_to_add = objects_to_insert[ min_bound : max_bound ], </div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                                         process = process )</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                    </div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                    <span class="comment"># Redefine the minimum bound of the interval</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                    min_bound = max_bound</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                    </div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                    self.close_session()</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            Logger.get_instance().warning( self.classname + <span class="stringliteral">&#39;.batch_insert_to_db():&#39;</span> +</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                                           <span class="stringliteral">&#39; There is no data to insert from &#39;</span> + process + <span class="stringliteral">&#39;.&#39;</span> +</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                           <span class="stringliteral">&#39; Warning code: &#39;</span> + LogCodes.WARN_INSERT_NODATA + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="a5c28f3b363cc8755f26f0666fc60545f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c28f3b363cc8755f26f0666fc60545f">&#9670;&nbsp;</a></span>build_database()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.build_database </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>db_settings</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>species</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>sp_mandatory</em> = <code>True</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>force_overwrite</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>build_database </h2>
<p>This method allows to build the database model at the expected location (SQLite file or MySQL server) or to check an existing database (at the provided location) matches the expected model.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_settings</td><td>Dictionnary - A dictionary of settings related to the database. This may include:<ul>
<li>The database name.</li>
<li>The database type (SQLite / MySQL).</li>
<li>For SQLite databases: the folder of SQLite file.</li>
<li>For MySQL databases: the MySQL user, password, host IP and port. </li>
</ul>
</td></tr>
    <tr><td class="paramname">species</td><td>String - The species of the database. </td></tr>
    <tr><td class="paramname">sp_mandatory</td><td>Boolean - Does the species name of the database is mandatory? True by default. </td></tr>
    <tr><td class="paramname">force_overwrite</td><td>Boolean - Does any existing DB at the provided location has to be removed? False by default.</td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When the species is not provided whilst expected. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keyword">def </span>build_database( self, db_settings, species, sp_mandatory=True, force_overwrite=False ):</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        </div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="comment"># Store the settings necessary to establish the connection</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        self.set_db_settings( db_settings )</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        </div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="comment"># Check that a species is provided</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">if</span> ( ( sp_mandatory ) </div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;             <span class="keywordflow">and</span> ( ( species == <span class="keywordtype">None</span> ) <span class="keywordflow">or</span> ( len( species ) == 0 ) ) ):</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + </div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                       <span class="stringliteral">&#39;.set_db_settings(): A species needs to be provided!&#39;</span> )</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            </div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="comment"># Get the engine to dedicated database</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        self.create_engine()</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        </div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment"># Check and / or remove the existing database if necessary</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">if</span> ( self.db_type == SQLConstants.DB_TYPE_SQLITE ):</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            reset_model = self.build_sqlite_database( force_overwrite )</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;          </div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="comment"># Check and / or remove the existing database if necessary</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment"># and / or create the database on the server if necessary</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">elif</span> ( self.db_type == SQLConstants.DB_TYPE_MYSQL ):</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            reset_model = self.build_mysql_database( force_overwrite )</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        </div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment"># Open a session</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        self.create_session()</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        </div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="comment"># If the model does not yet exists, create all the required tables</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordflow">if</span> reset_model:</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            self.BASE.metadata.create_all( self.engine )</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            Logger.get_instance().info( <span class="stringliteral">&#39;The database &#39;</span> + self.db_path + <span class="stringliteral">&#39; has been created.&#39;</span> )</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            </div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            Logger.get_instance().info( <span class="stringliteral">&#39;The database &#39;</span> + self.db_path + <span class="stringliteral">&#39; will be used.&#39;</span> )</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        </div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        self.session.close()</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        </div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            </div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            </div></div><!-- fragment -->
</div>
</div>
<a id="ae9383486d689190b0ea4cfa3b50bccd1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae9383486d689190b0ea4cfa3b50bccd1">&#9670;&nbsp;</a></span>build_mysql_database()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.build_mysql_database </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>force_overwrite</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>build_mysql_database </h2>
<p>This method checks if a database of the provided name already exists on the MySQL server. If the database exists</p><ul>
<li>and the forceOverwrite option has been selected, then remove all its content.</li>
<li>and the forceOverwrite option has not been selected, then check the database schema.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">force_overwrite</td><td>Boolean - Does any existing DB at the provided location has to be removed?</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Boolean - Does the database structure need to be re-build? </dd></dl>
<div class="fragment"><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keyword">def </span>build_mysql_database( self, force_overwrite ):</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            </div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="comment"># Get the list of existing databases on the server</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        eng_server = create_engine( self.db_uri )</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        existing_db = eng_server.execute( <span class="stringliteral">&#39;SHOW DATABASES;&#39;</span> )</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        existing_db = [ d[0] <span class="keywordflow">for</span> d <span class="keywordflow">in</span> existing_db ]</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        </div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="comment"># If there is a database of this name</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">if</span> ( self.db_name <span class="keywordflow">in</span> existing_db ):</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            </div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="comment"># And the forceOverwrite option has been selected,</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            <span class="comment"># then remove the existing database of the server, </span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="comment"># and create an empty new one</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">if</span> force_overwrite:</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                eng_server.execute( <span class="stringliteral">&#39;DROP DATABASE &#39;</span> +  self.db_name )</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                eng_server.execute( <span class="stringliteral">&#39;CREATE DATABASE &#39;</span> +  self.db_name )</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                Logger.get_instance().info( <span class="stringliteral">&#39;All the content related to the &#39;</span> + self.db_name + </div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                            <span class="stringliteral">&#39; database has been removed from the MySQL server.&#39;</span> )</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                </div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                <span class="comment"># Check if the existing database contains the appropriate model</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                <span class="keywordflow">if</span> ( <span class="keywordflow">not</span> self.check_database_str_integrity() ):</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                    </div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                    <span class="comment"># Ask the user to confirm the deletion of the database</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                    confirm_deletion = <span class="keywordtype">None</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                    Logger.get_instance().info( <span class="stringliteral">&#39;The database provided does not use the appropriate&#39;</span> +</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                                <span class="stringliteral">&#39; model. Hence, the database will be removed and build&#39;</span> +</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                                <span class="stringliteral">&#39; again using the right model.&#39;</span> )</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                    </div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                    <span class="keywordflow">while</span> ( confirm_deletion <span class="keywordflow">not</span> <span class="keywordflow">in</span> [ <span class="stringliteral">&#39;Y&#39;</span>, <span class="stringliteral">&#39;N&#39;</span> ] ):</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                        print( <span class="stringliteral">&#39; Do you want to confirm the deletion of the database? (Y/N)&#39;</span> )</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                        confirm_deletion = raw_input().upper()</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    </div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    <span class="comment"># If the user refuse the database to be deleted, log a critical error</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    <span class="keywordflow">if</span> confirm_deletion == <span class="stringliteral">&#39;N&#39;</span>:</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                        Logger.get_instance().critical( <span class="stringliteral">&#39;As the database does not use the appropriate&#39;</span> +</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                                        <span class="stringliteral">&#39; model and the deletion has been canceled by the&#39;</span> +</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                                        <span class="stringliteral">&#39; user, the program will be stopped. Please see&#39;</span> +</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                                        <span class="stringliteral">&#39; the documentation for more information.&#39;</span> )</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                    </div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                    <span class="comment"># Otherwise delete the database and create a new one</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    eng_server.execute( <span class="stringliteral">&#39;DROP DATABASE &#39;</span> +  self.db_name )</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                    eng_server.execute( <span class="stringliteral">&#39;CREATE DATABASE &#39;</span> +  self.db_name )</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                    Logger.get_instance().info( <span class="stringliteral">&#39;All the content related to the &#39;</span> + self.db_name + </div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                                <span class="stringliteral">&#39; database has been removed from the MySQL server.&#39;</span> )</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                         </div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="comment"># Otherwise, create an empty database on the server</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;            eng_server.execute( <span class="stringliteral">&#39;CREATE DATABASE &#39;</span> +  self.db_name )</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            Logger.get_instance().info( <span class="stringliteral">&#39;No database called &#39;</span> + self.db_name + </div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                        <span class="stringliteral">&#39; may be found on the MySQL server.&#39;</span> +</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                                        <span class="stringliteral">&#39; Hence, an empty database of this name will be created.&#39;</span> )</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        </div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        </div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        </div></div><!-- fragment -->
</div>
</div>
<a id="a3d01e836a891c6204148ebab7eb21d0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d01e836a891c6204148ebab7eb21d0b">&#9670;&nbsp;</a></span>build_sqlite_database()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.build_sqlite_database </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>force_overwrite</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>build_sqlite_database </h2>
<p>This method first checks if a SQLite file already exists at the provided path. If the file exists</p><ul>
<li>and the forceOverwrite option has been selected, then remove the file.</li>
<li>and the forceOverwrite option has not been selected, then check the database schema.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">force_overwrite</td><td>Boolean - Does any existing DB at the provided location has to be removed?</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Boolean - Does the database structure need to be re-build? </dd></dl>
<div class="fragment"><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keyword">def </span>build_sqlite_database( self, force_overwrite ):</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                        </div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment"># If there is already a database at the path</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">if</span> os.path.exists( self.db_path ):                      </div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            </div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="comment"># And the forceOverwrite option has been selected, </span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="comment"># then remove the database file</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="keywordflow">if</span> force_overwrite:</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                self.remove_sqlite_db()</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                </div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                <span class="comment"># Check if the existing database contains the</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <span class="comment"># appropriate model</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.check_database_str_integrity():</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                    </div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                    <span class="comment"># Ask the user to confirm the deletion of the database</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    confirm_deletion = <span class="keywordtype">None</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    Logger.get_instance().info( <span class="stringliteral">&#39;The database provided does not use the appropriate&#39;</span> +</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                                <span class="stringliteral">&#39; model. Hence, the database will be removed and build&#39;</span> +</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                                <span class="stringliteral">&#39; again using the right model.&#39;</span> )</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                    </div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                    <span class="keywordflow">while</span> ( confirm_deletion <span class="keywordflow">not</span> <span class="keywordflow">in</span> [ <span class="stringliteral">&#39;Y&#39;</span>, <span class="stringliteral">&#39;N&#39;</span> ] ):</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                        print( <span class="stringliteral">&#39; Do you want to confirm the deletion of the database? (Y/N)&#39;</span> )</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                        confirm_deletion = raw_input().upper()</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    </div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                    <span class="comment"># If the user refuse the database to be deleted, log a critical error</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                    <span class="keywordflow">if</span> ( confirm_deletion == <span class="stringliteral">&#39;N&#39;</span> ):</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                        Logger.get_instance().critical( <span class="stringliteral">&#39;As the database does not use the appropriate&#39;</span> +</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                                        <span class="stringliteral">&#39; model and the deletion has been canceled by the&#39;</span> +</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                                        <span class="stringliteral">&#39; user, the program will be stopped. Please see&#39;</span> +</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                                                        <span class="stringliteral">&#39; the documentation for more information.&#39;</span> )</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    </div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    <span class="comment"># Otherwise delete the database and create a new one</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                    self.remove_sqlite_db()</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                </div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                </div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="abb8f49f723b9f4aee02c1a8d073c8f3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb8f49f723b9f4aee02c1a8d073c8f3d">&#9670;&nbsp;</a></span>check_database_str_integrity()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.check_database_str_integrity </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>check_database_str_integrity </h2>
<p>This method checks if the schema of the database matches the model. This methods only check the name of the tables, the name of the columns and the primary keys. Other features such as the relationships or unique constraints are not checked.</p>
<dl class="section return"><dt>Returns</dt><dd>Boolean - Does the database structure follow the model? </dd></dl>
<div class="fragment"><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keyword">def </span>check_database_str_integrity( self ):</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        </div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        Logger.get_instance().info( <span class="stringliteral">&#39;Checking the structure of the database. Please note that only&#39;</span> +</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                                    <span class="stringliteral">&#39; the column names and primary keys will be checked.&#39;</span> +</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                                    <span class="stringliteral">&#39; Please see the documentation for more information.&#39;</span> )</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        </div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="comment"># Create the engine if it does not yet exists</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="keywordflow">if</span> ( self.engine == <span class="keywordtype">None</span> ):</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            self.create_engine()</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        </div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="comment"># Get the table names of the existing database</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        iengine = inspect( self.engine )</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        tables = iengine.get_table_names()</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        </div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        <span class="comment"># Build a dictionary of the classes defined in the model</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        dict_model_classes = {}</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">for</span> ( cl_name, cl_object ) <span class="keywordflow">in</span> self.BASE._decl_class_registry.items():</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> str( cl_name) == <span class="stringliteral">&#39;_sa_module_registry&#39;</span>:</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                dict_model_classes[ str( cl_name ) ] = cl_object</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            </div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        </div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        db_str_ok = <span class="keyword">True</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        </div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="comment"># Check that the table names in the database are the same as the one of the model</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        model_table_names = sorted( dict_model_classes.keys() )</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        db_table_names = sorted( iengine.get_table_names() )</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="keywordflow">if</span> ( model_table_names != db_table_names ):</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            Logger.get_instance().debug( self.classname + <span class="stringliteral">&#39;.check_database_str_integrity():&#39;</span> +</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                                         <span class="stringliteral">&#39; The database contains the following tables: &quot;&#39;</span> +</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                                         <span class="stringliteral">&#39;, &#39;</span>.join( db_table_names ) + <span class="stringliteral">&#39;&quot; whilst the tables &quot;&#39;</span> + </div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                                         <span class="stringliteral">&#39;, &#39;</span>.join( model_table_names ) + <span class="stringliteral">&#39;&quot; are expected to be present.&#39;</span> )</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            db_str_ok = <span class="keyword">False</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        </div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="comment"># For each table, check the columns and the primary key</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="comment"># NB: Unique constraints, foreign keys and relationships are not checked</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        key_iterator = iter( dict_model_classes )</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        t = next( key_iterator, <span class="keywordtype">None</span> )</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        </div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="keywordflow">while</span> ( t != <span class="keywordtype">None</span> ) <span class="keywordflow">and</span> ( db_str_ok ):</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            </div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            Logger.get_instance().debug( self.classname + <span class="stringliteral">&#39;.check_database_str_integrity():&#39;</span> +</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                                         <span class="stringliteral">&#39; Checking the structure of the table &#39;</span> + str( t ) + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            </div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="comment"># Get the corresponding class in the model</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            model_cl = dict_model_classes[ t ]</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            model_mapper = inspect( model_cl )</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            </div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="comment"># Compare the column names</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            db_col_names = [ k[ <span class="stringliteral">&#39;name&#39;</span> ] <span class="keywordflow">for</span> k <span class="keywordflow">in</span> iengine.get_columns( t ) ]            </div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            model_col_names = model_mapper.column_attrs.keys()</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            <span class="keywordflow">if</span> ( db_col_names == [] ):</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                Logger.get_instance().debug( self.classname + <span class="stringliteral">&#39;.check_database_str_integrity():&#39;</span> +</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                                             <span class="stringliteral">&#39; The table &#39;</span> + str( t ) + <span class="stringliteral">&#39; does not contain any&#39;</span> +</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                                             <span class="stringliteral">&#39; column in the database.&#39;</span> )</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                db_str_ok = <span class="keyword">False</span>         </div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">elif</span> ( sorted( db_col_names ) != sorted( model_col_names ) ):</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                Logger.get_instance().debug( self.classname + <span class="stringliteral">&#39;.check_database_str_integrity():&#39;</span> +</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                             <span class="stringliteral">&#39; The table &#39;</span> + str( t ) + <span class="stringliteral">&#39; contains the columns &quot;&#39;</span> + </div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                                             <span class="stringliteral">&#39;, &#39;</span>.join( db_col_names ) + </div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                                             <span class="stringliteral">&#39;&quot; whilst the following column names are expected &quot;&#39;</span> + </div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                             <span class="stringliteral">&#39;, &#39;</span>.join( model_col_names ) + <span class="stringliteral">&#39;&quot; to be present.&#39;</span> )</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                db_str_ok = <span class="keyword">False</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                </div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <span class="comment"># Compare the primary key</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            db_pk = iengine.get_primary_keys( t )</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            model_pk = [ k.name <span class="keywordflow">for</span> k <span class="keywordflow">in</span> model_mapper.primary_key ]</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">if</span> ( db_str_ok <span class="keywordflow">and</span> ( sorted( db_pk ) != sorted( model_pk ) ) ):</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                Logger.get_instance().debug( self.classname + <span class="stringliteral">&#39;.check_database_str_integrity():&#39;</span> +</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                                             <span class="stringliteral">&#39; The table &#39;</span> + str( t ) + <span class="stringliteral">&#39; of the database has &quot;&#39;</span> + </div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                                             <span class="stringliteral">&#39;, &#39;</span>.join( db_col_names ) + <span class="stringliteral">&#39;&quot; for primary key&#39;</span> +</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                             <span class="stringliteral">&#39; whilst the primary key is expected to be &quot;&#39;</span> + </div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                             <span class="stringliteral">&#39;, &#39;</span>.join( model_col_names ) + <span class="stringliteral">&#39;&quot;.&#39;</span> )</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                db_str_ok = <span class="keyword">False</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            t = next( key_iterator, <span class="keywordtype">None</span> )</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            </div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        <span class="keywordflow">return</span> db_str_ok</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    </div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="ac4aa87a547b45ff0857f9367065e9411"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4aa87a547b45ff0857f9367065e9411">&#9670;&nbsp;</a></span>close_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.close_session </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>close_session </h2>
<p>This method close the session is there is one opened. </p>
<div class="fragment"><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keyword">def </span>close_session( self ):</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        </div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">if</span> ( self.session != <span class="keywordtype">None</span> ):</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            self.session.close()</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            self.session = <span class="keywordtype">None</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a23abb895a9c87afd769ba4bdcc51905f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23abb895a9c87afd769ba4bdcc51905f">&#9670;&nbsp;</a></span>commit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.commit </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>commit </h2>
<p>This method allows to commit the actual session and to close it right after. If the commit fails, the session is rollbacked and closed and a DenCellORFException is raised.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When an exception is raised trying to commit the session. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keyword">def </span>commit( self ):</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            self.get_session().commit()</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        <span class="keywordflow">except</span> exc.SQLAlchemyError <span class="keyword">as</span> e:</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            self.rollback_session()</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + <span class="stringliteral">&#39;.commit(): A SQLAlchemy error occurred trying&#39;</span> +</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                                       <span class="stringliteral">&#39; to commit the session. Hence the session has been roll backed.&#39;</span>, e )</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            self.rollback_session()</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + <span class="stringliteral">&#39;.commit(): An error occurred trying&#39;</span> +</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                                       <span class="stringliteral">&#39; to commit the session. Hence the session has been roll backed.&#39;</span>, e )</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keywordflow">finally</span>:</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            self.close_session()</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="aa1d6812a8a313773d0a6da882560932f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1d6812a8a313773d0a6da882560932f">&#9670;&nbsp;</a></span>create_db_url()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.create_db_url </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>create_db_url </h2>
<p>Create the appropriate database URL according to the type of the database and known settings. The URL is then stored as an instance attribute. </p>
<div class="fragment"><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keyword">def </span>create_db_url( self ):</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        </div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">if</span> ( self.db_type == SQLConstants.DB_TYPE_SQLITE ):</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            self.db_path = ( self.db_settings[ Constants.DB_SETTINGS_DB_FOLDER ] + </div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                             self.db_name + SQLConstants.SQLITE_EXTENSION )</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            self.db_uri = SQLConstants.SQLALCHEMY_SQLITE_URI</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            self.db_url = self.db_uri + self.db_path</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            </div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            </div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordflow">elif</span> ( self.db_type == SQLConstants.DB_TYPE_MYSQL ):</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            self.db_path = self.db_name</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            self.db_uri = ( SQLConstants.SQLALCHEMY_MYSQL_URI_PREFIX +</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                            <span class="stringliteral">&#39;{}:{}@{}:{}/&#39;</span>.format( self.db_settings[ Constants.DB_SETTINGS_MYSQL_USER ],</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                                   self.db_settings[ Constants.DB_SETTINGS_MYSQL_PASSWD  ],</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                                                   self.db_settings[ Constants.DB_SETTINGS_MYSQL_HOST ],</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                                   self.db_settings[ Constants.DB_SETTINGS_MYSQL_PORT ] ) )</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            self.db_url = self.db_uri + self.db_name</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="aaa3e2d9510429ba9643d224930ee64eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa3e2d9510429ba9643d224930ee64eb">&#9670;&nbsp;</a></span>create_engine()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.create_engine </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>create_engine </h2>
<p>This method allows to create the SQLAlchemy engine of the DB.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When an the database type selected by the user is not allowed. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keyword">def </span>create_engine( self ):</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        </div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keywordflow">if</span> ( self.db_type <span class="keywordflow">in</span> SQLConstants.AUTORIZED_DB_TYPES ):</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            </div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordflow">if</span> ( self.db_url != <span class="keywordtype">None</span> ):</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                </div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                <span class="comment"># Create the engine</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                <span class="keywordflow">if</span> ( self.db_type == SQLConstants.DB_TYPE_MYSQL ):</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                    engine = create_engine( self.db_url + <span class="stringliteral">&#39;?charset=utf8mb4&#39;</span>, encoding=<span class="stringliteral">&#39;utf-8&#39;</span>, pool_pre_ping=<span class="keyword">True</span> )</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                </div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                    <span class="comment"># Set the maximal allowed size for packet of MySQL</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                    @event.listens_for( engine, <span class="stringliteral">&#39;connect&#39;</span> )</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                    <span class="keyword">def </span>set_max_allowed_packet( dbapi_connection, connection_record ):</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                        cursor = dbapi_connection.cursor()</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                        cursor.execute( <span class="stringliteral">&#39;SET GLOBAL max_allowed_packet = &#39;</span> + str( SQLConstants.MYSQL_MAX_ALLOWED_PACKET ) )</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                        cursor.close()                    </div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                        </div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                    <span class="comment"># Set the maximum size of strings get by concatenating objects during queries</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                    @event.listens_for( engine, <span class="stringliteral">&#39;connect&#39;</span> )</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                    <span class="keyword">def </span>set_group_concat_max_len( dbapi_connection, connection_record ):</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                        cursor = dbapi_connection.cursor()</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                        cursor.execute( <span class="stringliteral">&#39;SET group_concat_max_len = &#39;</span> + str( SQLConstants.MYSQL_GROUP_CONCAT_MAX_LEN ) )</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                        cursor.close()</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                        </div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                <span class="keywordflow">elif</span> ( self.db_type == SQLConstants.DB_TYPE_SQLITE ):</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                    engine = create_engine( self.db_url, encoding=<span class="stringliteral">&#39;utf-8&#39;</span>, pool_pre_ping=<span class="keyword">True</span> )</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                    </div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                    <span class="comment"># Enforce foreign key constraints</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                    @event.listens_for( engine, <span class="stringliteral">&#39;connect&#39;</span> )</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                    <span class="keyword">def </span>set_sqlite_pragma( dbapi_connection, connection_record ):</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                        cursor = dbapi_connection.cursor()</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                        cursor.execute( <span class="stringliteral">&#39;PRAGMA foreign_keys=ON&#39;</span> )</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                        cursor.close()</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                    </div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="comment"># Set the maximum memory allowed for the range optimizer</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                @event.listens_for( engine, <span class="stringliteral">&#39;connect&#39;</span> )</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                <span class="keyword">def </span>set_range_optimizer_max_mem_size( dbapi_connection, connection_record ):</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                    cursor = dbapi_connection.cursor()</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                    cursor.execute( <span class="stringliteral">&#39;SET GLOBAL range_optimizer_max_mem_size = &#39;</span> + str( SQLConstants.RANGE_OPTIMIZER_MAX_MEM_SIZE ) )</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                    cursor.close()  </div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                    </div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            </div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                engine = <span class="keywordtype">None</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            </div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;SQLManger.create_engine(): the database type selected (&#39;</span> + </div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                                       SQLConstants.DEFAULT_DB_TYPE + <span class="stringliteral">&#39;) is not correct (accepted&#39;</span> +</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                                       <span class="stringliteral">&#39; database types: &#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( SQLConstants.AUTORIZED_DB_TYPES ) + </div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                       <span class="stringliteral">&#39;). Please see the documentation for more information.&#39;</span> )</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            </div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        self.engine = engine</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            </div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a3f32a81a8b5f6bcbe44eab986c144dc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f32a81a8b5f6bcbe44eab986c144dc5">&#9670;&nbsp;</a></span>create_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.create_session </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>create_session </h2>
<p>This method creates a SQLAlchemy session to the DB. </p>
<div class="fragment"><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keyword">def </span>create_session( self ):</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        </div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="comment"># Get the engine</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        engine = self.get_engine()</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        </div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment"># Open the DB session</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        session = sessionmaker()</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        session.configure( bind = engine, </div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                           autoflush = <span class="keyword">False</span>, </div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                           expire_on_commit = <span class="keyword">False</span> )</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        </div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        self.session = session()</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="ac9c62ac9da213140e8b575b2a0615d31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9c62ac9da213140e8b575b2a0615d31">&#9670;&nbsp;</a></span>db_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.db_exists </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>db_exists </h2>
<p>This method allows to check if the database already exists.</p>
<dl class="section return"><dt>Returns</dt><dd>Boolean - Does the database already exists? </dd></dl>
<div class="fragment"><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="keyword">def </span>db_exists( self ):</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        </div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        db_exists = <span class="keyword">False</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordflow">if</span> ( self.db_type == SQLConstants.DB_TYPE_SQLITE ):</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="keywordflow">if</span> os.path.exists( self.db_path ):</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                db_exists = <span class="keyword">True</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            </div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">elif</span> ( self.db_type == SQLConstants.DB_TYPE_MYSQL ):</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            </div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="comment"># Get the list of existing databases on the server</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            eng_server = create_engine( self.db_uri )</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            existing_db = eng_server.execute( <span class="stringliteral">&#39;SHOW DATABASES;&#39;</span> )</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            existing_db = [ d[0] <span class="keywordflow">for</span> d <span class="keywordflow">in</span> existing_db ]</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            </div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="comment"># If there is a database of this name</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keywordflow">if</span> ( self.db_name <span class="keywordflow">in</span> existing_db ):</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                db_exists = <span class="keyword">True</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                </div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">return</span> db_exists</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            </div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="aee08d3b71842bcf84dacbcfeb385874f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee08d3b71842bcf84dacbcfeb385874f">&#9670;&nbsp;</a></span>get_db_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.get_db_name </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>get_db_name </h2>
<p>This method returns the database name handled by the instance.</p>
<dl class="section return"><dt>Returns</dt><dd>self.db_name </dd></dl>
<div class="fragment"><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keyword">def </span>get_db_name( self ):</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        </div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">return</span> self.db_name</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            </div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a544448c4284b03097b2f474080a66fc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a544448c4284b03097b2f474080a66fc6">&#9670;&nbsp;</a></span>get_declarative_base()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.get_declarative_base </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>get_declarative_base </h2>
<p>This method returns the database declarative base instance used by the <a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1util_1_1sql_1_1SQLManager_1_1SQLManager.html">SQLManager</a>.</p>
<dl class="section return"><dt>Returns</dt><dd>self.BASE </dd></dl>
<div class="fragment"><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <span class="keyword">def </span>get_declarative_base( self ):</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        </div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="keywordflow">return</span> self.BASE</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        </div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="a26739db944f13d96a3f37a4aa8583580"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26739db944f13d96a3f37a4aa8583580">&#9670;&nbsp;</a></span>get_engine()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.get_engine </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>get_engine </h2>
<p>This method returns the SQLAlchemy engine to the DB. If the engine do not yet exist, it creates the engine.</p>
<dl class="section return"><dt>Returns</dt><dd>engine: The SQLAlchemy engine of the DB. </dd></dl>
<div class="fragment"><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keyword">def </span>get_engine( self ):</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordflow">if</span> ( self.engine == <span class="keywordtype">None</span> ):</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            </div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="keywordflow">if</span> ( self.db_url != <span class="keywordtype">None</span> ):</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                self.create_engine()</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        </div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keywordflow">return</span> self.engine</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a2ea29a524e66e1718dda6af31b4f6ba3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ea29a524e66e1718dda6af31b4f6ba3">&#9670;&nbsp;</a></span>get_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.get_session </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>get_session </h2>
<p>This method returns the current SQLAlchemy session if it exists or create a new one if no session has been yet open.</p>
<dl class="section return"><dt>Returns</dt><dd>Session - a new or the current SQLAlchemy session. </dd></dl>
<div class="fragment"><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keyword">def </span>get_session( self ):</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment"># Create the session if necessary</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        <span class="keywordflow">if</span> ( self.session == <span class="keywordtype">None</span> ):</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            self.create_session()</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="keywordflow">return</span> self.session</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a82d8caf36f15ee6653fae8318849d7b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82d8caf36f15ee6653fae8318849d7b6">&#9670;&nbsp;</a></span>remove_sqlite_db()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.remove_sqlite_db </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>remove_sqlite_db </h2>
<p>This method allows to remove the database SQLite file.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When an exception has been raised trying to delete the file. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keyword">def </span>remove_sqlite_db( self ):</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;           </div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">if</span> os.path.exists( self.db_path ):</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                remove( self.db_path )</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;The database located at &#39;</span> + str( self.db_path ) + </div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                                           <span class="stringliteral">&#39; cannot be deleted.&#39;</span> )</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                Logger.get_instance().info( <span class="stringliteral">&#39;The database file located at &#39;</span> + str( self.db_path ) + </div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                                            <span class="stringliteral">&#39; has been deleted.&#39;</span> )</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            </div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            Logger.get_instance().error( self.classname + <span class="stringliteral">&#39;.remove_sqlite_db(): There is no file&#39;</span> +</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                                         <span class="stringliteral">&#39; located at&#39;</span> + str( self.db_path ) + <span class="stringliteral">&#39;.&#39;</span> +</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                                         <span class="stringliteral">&#39; Error code: &#39;</span> + LogCodes.ERR_SQL_FILE + <span class="stringliteral">&#39;.&#39;</span>,</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                         ex = <span class="keyword">False</span> )</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            </div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a7f776a82f32614882d5aa4c323366692"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f776a82f32614882d5aa4c323366692">&#9670;&nbsp;</a></span>rollback_session()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.rollback_session </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>rollback_session </h2>
<p>This method allows to rollback the session.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When an exception is raised trying to rollback the session. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keyword">def </span>rollback_session( self ):</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        </div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            self.get_session().rollback()</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keywordflow">except</span> exc.SQLAlchemyError <span class="keyword">as</span> e:</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + <span class="stringliteral">&#39;.rollback(): A SQLAlchemy error occurred trying to&#39;</span> +</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                       <span class="stringliteral">&#39; rollback the session.&#39;</span>, e )</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + <span class="stringliteral">&#39;.rollback(): An error occurred trying to&#39;</span> +</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                       <span class="stringliteral">&#39; rollback the session.&#39;</span>, e )</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a783dbcbdfedc5ae5109e67dddbaf8f73"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a783dbcbdfedc5ae5109e67dddbaf8f73">&#9670;&nbsp;</a></span>session_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.session_exists </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>session_exists </h2>
<p>This method has only been created for debugging purpose. It returns True if a session is currently opened to the database.</p>
<dl class="section return"><dt>Returns</dt><dd>Boolean: Does a session is currently opened? </dd></dl>
<div class="fragment"><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keyword">def </span>session_exists( self ):</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        </div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">if</span> ( self.session == <span class="keywordtype">None</span> ):</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">False</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">True</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a2ce4a10aa6357215b3c62f93b37a80ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ce4a10aa6357215b3c62f93b37a80ce">&#9670;&nbsp;</a></span>set_db_settings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.util.sql.SQLManager.SQLManager.set_db_settings </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>db_settings</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>set_db_settings </h2>
<p>Set the settings necessary to established the connection to the database (i.e. used by the SQLAlchemu session).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_settings</td><td>Dictionnary - The dictionary of settings. This may include:<ul>
<li>The database name (required).</li>
<li>The database type (SQLite / MySQL) (optional).</li>
<li>For SQLite databases: the folder of SQLite file (optional).</li>
<li>For MySQL databases: the MySQL user, password, host IP and port (optional).</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When the database name is missing. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keyword">def </span>set_db_settings( self, db_settings ):</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        </div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="comment"># Store the settings of the database</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        self.db_settings = db_settings</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        </div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="comment"># Store the database name</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        self.db_name = db_settings[ Constants.DB_SETTINGS_DB_NAME ]</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        </div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="comment"># Check that a database name is provided</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">if</span> ( self.db_name == <span class="keywordtype">None</span> <span class="keywordflow">or</span> len( self.db_name ) == 0 ):</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( self.classname + </div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                                       <span class="stringliteral">&#39;.set_db_settings(): A database name needs to be provided!&#39;</span> )</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    </div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="comment"># Set the database type to default if not provided</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">if</span> ( ( Constants.DB_SETTINGS_DB_TYPE <span class="keywordflow">in</span> self.db_settings.keys() )</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;             <span class="keywordflow">and</span> ( self.db_settings[ Constants.DB_SETTINGS_DB_TYPE ] != <span class="keywordtype">None</span> ) ):</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            self.db_type = self.db_settings[ Constants.DB_SETTINGS_DB_TYPE ]</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            self.db_type = SQLConstants.DEFAULT_DB_TYPE</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            Logger.get_instance().debug( self.classname + <span class="stringliteral">&#39;.set_db_settings(): As no type of database&#39;</span> +</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                         <span class="stringliteral">&#39; has been provided, the database type has been set to &#39;</span> +  </div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                                         self.db_type + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        </div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment"># Set all the parameters to default that are not provided to default</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span> ( self.db_type == SQLConstants.DB_TYPE_SQLITE ):</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            </div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">if</span> ( ( Constants.DB_SETTINGS_DB_FOLDER <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.db_settings.keys() ) </div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                 <span class="keywordflow">or</span> ( self.db_settings[ Constants.DB_SETTINGS_DB_FOLDER ] == <span class="keywordtype">None</span> ) ):</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                self.db_settings[ Constants.DB_SETTINGS_DB_FOLDER ] = SQLConstants.DEFAULT_SQLITE_PATH</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            </div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <span class="keywordflow">if</span> ( self.db_settings[ Constants.DB_SETTINGS_DB_FOLDER ][-1] != <span class="stringliteral">&#39;/&#39;</span> ):</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                self.db_settings[ Constants.DB_SETTINGS_DB_FOLDER ] += <span class="stringliteral">&#39;/&#39;</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            </div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            </div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">elif</span> ( self.db_type == SQLConstants.DB_TYPE_MYSQL ):</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                    </div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <span class="keywordflow">if</span> ( ( Constants.DB_SETTINGS_MYSQL_USER <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.db_settings.keys() )</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                 <span class="keywordflow">or</span> ( self.db_settings[ Constants.DB_SETTINGS_MYSQL_USER ] == <span class="keywordtype">None</span> ) ):</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                self.db_settings[ Constants.DB_SETTINGS_MYSQL_USER ] = SQLConstants.DEFAULT_MYSQL_USER_NAME</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        </div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="keywordflow">if</span> ( ( Constants.DB_SETTINGS_MYSQL_PASSWD <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.db_settings.keys() )</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                 <span class="keywordflow">or</span> ( self.db_settings[ Constants.DB_SETTINGS_MYSQL_PASSWD ] == <span class="keywordtype">None</span> ) ):</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                self.db_settings[ Constants.DB_SETTINGS_MYSQL_PASSWD  ] = SQLConstants.DEFAULT_MYSQL_USER_PASSWD                </div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        </div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="keywordflow">if</span> ( ( Constants.DB_SETTINGS_MYSQL_HOST <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.db_settings.keys() ) </div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                 <span class="keywordflow">or</span> ( self.db_settings[ Constants.DB_SETTINGS_MYSQL_HOST ] == <span class="keywordtype">None</span> ) ):</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                self.db_settings[ Constants.DB_SETTINGS_MYSQL_HOST ] = SQLConstants.DEFAULT_HOST_IP</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        </div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">if</span> ( ( Constants.DB_SETTINGS_MYSQL_PORT <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.db_settings.keys() ) </div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                 <span class="keywordflow">or</span> ( self.db_settings[ Constants.DB_SETTINGS_MYSQL_PORT ] == <span class="keywordtype">None</span> ) ):</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                self.db_settings[ Constants.DB_SETTINGS_MYSQL_PORT ] = SQLConstants.DEFAULT_MYSQL_PORT</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                </div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="comment"># Create the database URL</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        self.create_db_url()</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    </div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    </div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/mnt/NAS7/Workspace/choteaus/tagc-uorf/project/01_ORF_datafreeze/06_src/fr/tagc/uorf/core/util/sql/SQLManager.py</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
