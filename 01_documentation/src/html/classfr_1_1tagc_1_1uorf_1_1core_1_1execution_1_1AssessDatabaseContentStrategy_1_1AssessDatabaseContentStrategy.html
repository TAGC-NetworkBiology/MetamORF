<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sORFdatafreezer: fr.tagc.uorf.core.execution.AssessDatabaseContentStrategy.AssessDatabaseContentStrategy Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sORFdatafreezer
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>fr</b></li><li class="navelem"><b>tagc</b></li><li class="navelem"><b>uorf</b></li><li class="navelem"><b>core</b></li><li class="navelem"><b>execution</b></li><li class="navelem"><b>AssessDatabaseContentStrategy</b></li><li class="navelem"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html">AssessDatabaseContentStrategy</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">fr.tagc.uorf.core.execution.AssessDatabaseContentStrategy.AssessDatabaseContentStrategy Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Inherits object.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af15b63450753fb0f1c94e9812d2acd3d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html#af15b63450753fb0f1c94e9812d2acd3d">__init__</a> (self)</td></tr>
<tr class="separator:af15b63450753fb0f1c94e9812d2acd3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef021d8eb2149afd6efb3867cd50c91a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html#aef021d8eb2149afd6efb3867cd50c91a">execute</a> (self)</td></tr>
<tr class="separator:aef021d8eb2149afd6efb3867cd50c91a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a294c26ed42088010c816fec98fd85b53"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html#a294c26ed42088010c816fec98fd85b53">assess_DS_consistency</a> (self)</td></tr>
<tr class="separator:a294c26ed42088010c816fec98fd85b53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90bfe18c025200af6d54c3105dad3a58"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html#a90bfe18c025200af6d54c3105dad3a58">assess_PRO_consistency</a> (self)</td></tr>
<tr class="separator:a90bfe18c025200af6d54c3105dad3a58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f3e0db5a03b71fc8c55d652755d34d1"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html#a1f3e0db5a03b71fc8c55d652755d34d1">init_log_file</a> (self, ext='.tsv')</td></tr>
<tr class="separator:a1f3e0db5a03b71fc8c55d652755d34d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a667f34610c1164e1c62d243d90a55018"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html#a667f34610c1164e1c62d243d90a55018">add_to_log_file</a> (self, message, ext='.tsv')</td></tr>
<tr class="separator:a667f34610c1164e1c62d243d90a55018"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36525738220b7a1248ed8a9085f4f5cc"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html#a36525738220b7a1248ed8a9085f4f5cc">get_sqlmanager_instance</a> (self)</td></tr>
<tr class="separator:a36525738220b7a1248ed8a9085f4f5cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html">AssessDatabaseContentStrategy</a> </h1>
<p>This class is a strategy aiming to assess the consistency of the data in contained in a DS or a PRO database. It allows to generate a log file reporting all successful checks and any unexpected inconsistency found in the data and that could have been generated by the program itself. Hence, this strategy is mainly dedicated to the developers of the current program and aims to help detecting programming errors that could have been left in the source code. It may also be useful for the user in order to help detecting any inconsistency in the data that could have been introduced manually or by an other program. e.g. If entries of the DSORF table (DS database) are found with a higher value for their stop position than for their start position, this may suggest an error in the code of the LiftOver strategy. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="af15b63450753fb0f1c94e9812d2acd3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af15b63450753fb0f1c94e9812d2acd3d">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AssessDatabaseContentStrategy.AssessDatabaseContentStrategy.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>Constructor of <a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AssessDatabaseContentStrategy_1_1AssessDatabaseContentStrategy.html">AssessDatabaseContentStrategy</a> </h2>
<p>Instance variables:</p><ul>
<li>db_settings: Dictionary - A dictionary of settings (Strings). This may include:<ul>
<li>The database name.</li>
<li>The database type (SQLite / MySQL).</li>
<li>For SQLite databases: the folder of SQLite file.</li>
<li>For MySQL databases: the MySQL user, password, host IP and port.</li>
</ul>
</li>
<li>db_model: String - The name of the database model to use (PRO / DS).</li>
<li>output_folder: String - The path of the folder where to save the file containing the logs.</li>
<li>file_name: String - The name of the generated file.</li>
</ul>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When the database type provided is not allowed. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">def </span>__init__( self ):</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        </div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment"># Get the options necessary to establish the connection to the database</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        self.db_settings = {}</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        self.db_settings[ Constants.DB_SETTINGS_DB_TYPE ] = OptionManager.get_instance().get_option( OptionConstants.OPTION_DB_TYPE )</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        self.db_settings[ Constants.DB_SETTINGS_DB_NAME ] = OptionManager.get_instance().get_option( OptionConstants.OPTION_DB_NAME, </div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                                                                                     not_none = <span class="keyword">True</span> )</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        </div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">if</span> ( self.db_settings[ Constants.DB_SETTINGS_DB_TYPE ] == SQLConstants.DB_TYPE_MYSQL ):</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            self.db_settings[ Constants.DB_SETTINGS_MYSQL_USER ] = OptionManager.get_instance().get_option( OptionConstants.OPTION_DB_MYSQL_USER )</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            self.db_settings[ Constants.DB_SETTINGS_MYSQL_PASSWD ] = OptionManager.get_instance().get_option( OptionConstants.OPTION_DB_MYSQL_PASSWD )</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            self.db_settings[ Constants.DB_SETTINGS_MYSQL_HOST ] = OptionManager.get_instance().get_option( OptionConstants.OPTION_DB_MYSQL_HOST_IP )</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            self.db_settings[ Constants.DB_SETTINGS_MYSQL_PORT ] = OptionManager.get_instance().get_option( OptionConstants.OPTION_DB_MYSQL_PORT )</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            </div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">elif</span> ( self.db_settings[ Constants.DB_SETTINGS_DB_TYPE ] == SQLConstants.DB_TYPE_SQLITE ):</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            self.db_settings[ Constants.DB_SETTINGS_DB_FOLDER ] = OptionManager.get_instance().get_option( OptionConstants.OPTION_DB_FOLDER )</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="comment"># Get the model of database</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        self.db_model = OptionManager.get_instance().get_option( OptionConstants.OPTION_DATABASE_MODEL, </div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                                                                 not_none = <span class="keyword">True</span> )</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">if</span> ( self.db_model <span class="keywordflow">not</span> <span class="keywordflow">in</span> OptionConstants.AVAILABLE_DATABASE_MODELS ):</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;The database model provided has to be in the following list: &#39;</span> + </div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                                       <span class="stringliteral">&#39;, &#39;</span>.join( OptionConstants.AVAILABLE_DATABASE_MODELS ) + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        </div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="comment"># Get the output folder</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        self.output_folder = OptionManager.get_instance().get_option( OptionConstants.OPTION_OUTPUT_FOLDER, </div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                                                      not_none = <span class="keyword">False</span> )</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">if</span> ( <span class="keywordflow">not</span> self.output_folder ):</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="comment"># By default, save the file in the default output folder</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            self.output_folder = Constants.DB_CONTENT_CONSISTENCY_ASSESSMENT_FOLDER</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        </div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="comment"># Get the eventual name to use for the generated file</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        self.file_name = OptionManager.get_instance().get_option( OptionConstants.OPTION_ASSESS_FILENAME,</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                                                                  not_none = <span class="keyword">False</span> )</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">if</span> ( <span class="keywordflow">not</span> self.file_name ):</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="comment"># By default, save the file as &#39;DatabaseAssessment&#39; file</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="comment"># with the database model as prefix</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            self.file_name = self.db_model + <span class="stringliteral">&#39;DatabaseAssessment&#39;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            </div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    </div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a667f34610c1164e1c62d243d90a55018"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a667f34610c1164e1c62d243d90a55018">&#9670;&nbsp;</a></span>add_to_log_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AssessDatabaseContentStrategy.AssessDatabaseContentStrategy.add_to_log_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ext</em> = <code>'.tsv'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>add_to_log_file </h2>
<p>This method allows to add a line to the log file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">message</td><td>String - The message to add in the log file. </td></tr>
    <tr><td class="paramname">ext</td><td>String - The extension of the file. ".tsv" by default. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keyword">def </span>add_to_log_file( self, message, ext=&#39;.tsv&#39; ):</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        </div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        file_path = os.path.join( self.output_folder, self.file_name + ext )</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        </div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        file = open( file_path, mode = <span class="stringliteral">&#39;a&#39;</span> )</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        file.write( message + <span class="stringliteral">&#39;\n&#39;</span> )</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        file.close()</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    </div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    </div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="a294c26ed42088010c816fec98fd85b53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a294c26ed42088010c816fec98fd85b53">&#9670;&nbsp;</a></span>assess_DS_consistency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AssessDatabaseContentStrategy.AssessDatabaseContentStrategy.assess_DS_consistency </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>assess_DS_consistency </h2>
<p>This method allows to check the consistency of the data contained in the DS database. </p>
<div class="fragment"><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keyword">def </span>assess_DS_consistency( self ):</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                </div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="comment"># DSORF table</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment"># -----------</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;---\t&#39;</span> + <span class="stringliteral">&#39;Assessment of the consistency the DSORF table content&#39;</span> )</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        </div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment"># Check the list of chromosomes</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        chr_list = SQLManagerDS.get_instance().get_session().query( DSORF.chromosome ).distinct().all()</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        chr_list = sorted( GeneralUtil.query_result_to_list( chr_list ) )</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of chromosomes:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( chr_list ) + <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        </div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment"># Check the list of raw_strands</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        raw_strand_list = SQLManagerDS.get_instance().get_session().query( DSORF.raw_strand ).filter( DSORF.raw_strand != <span class="keywordtype">None</span> ).distinct().all()</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        raw_strand_list = sorted( GeneralUtil.query_result_to_list( raw_strand_list ) )</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">if</span> ( set( raw_strand_list ).issubset( [ <span class="stringliteral">&#39;+&#39;</span>, <span class="stringliteral">&#39;-&#39;</span> ] ) ):</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Raw strands:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( raw_strand_list ) + <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Raw strands:\t&#39;</span> +  <span class="stringliteral">&#39;, &#39;</span>.join( raw_strand_list ) + <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        </div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="comment"># Check the list of strands</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        strand_list = SQLManagerDS.get_instance().get_session().query( DSORF.strand ).filter( DSORF.strand != <span class="keywordtype">None</span> ).distinct().all()</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        strand_list = sorted( GeneralUtil.query_result_to_list( strand_list ) )</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">if</span> ( set( strand_list ).issubset( [ <span class="stringliteral">&#39;+&#39;</span>, <span class="stringliteral">&#39;-&#39;</span> ] ) ):</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Strands:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( strand_list ) + <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Strands:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( strand_list ) + <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        </div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment"># Check there are no raw_stop_pos lower than the corresponding raw_start_pos </span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        raw_start_gt_stop = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( DSORF.raw_start_pos &gt;= DSORF.raw_stop_pos ).count()</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordflow">if</span> ( raw_start_gt_stop == 0 ):</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Raw positions:\t&#39;</span> + </div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs have the raw start position lower than the raw stop position&#39;</span> + </div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Raw positions:\t&#39;</span> + </div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs for which the raw start position is greater than the&#39;</span> +</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                  <span class="stringliteral">&#39; raw stop position: &#39;</span> + str( raw_start_gt_stop ) + </div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        </div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment"># Check there are no stop_pos lower than the corresponding start_pos </span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        start_gt_stop = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( DSORF.start_pos &gt;= DSORF.stop_pos ).count()</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">if</span> ( start_gt_stop == 0 ):</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Positions:\t&#39;</span> + </div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs have the start position lower than the stop position&#39;</span> + </div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> ) </div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Positions:\t&#39;</span> + </div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs for which the start position is greater than the&#39;</span> +</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                  <span class="stringliteral">&#39; stop position: &#39;</span> + str( start_gt_stop ) + </div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        </div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment"># Check that all the ORFs that are not spliced have one single &quot;exon&quot;</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        not_spl_single_exon = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( ( DSORF.spliced == <span class="keyword">False</span> ), </div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                                                                               ( DSORF.spliced_parts_count != 1 ) ).count()</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">if</span> ( not_spl_single_exon == 0 ):</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon number:\t&#39;</span> + </div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs not spliced have a single exon&#39;</span> + </div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon number:\t&#39;</span> + </div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs not spliced that have more than one single exon: &#39;</span> +</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                  str( not_spl_single_exon ) + </div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            </div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment"># Check that all the ORFs that are not spliced do not have any spliced positions</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        not_spl_positions = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( ( DSORF.spliced == <span class="keyword">False</span> ),</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                                                                             or_( ( DSORF.raw_splice_starts != <span class="keywordtype">None</span> ),</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                                                                                  ( DSORF.raw_splice_ends != <span class="keywordtype">None</span> ) ) ).count()</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">if</span> ( not_spl_positions == 0 ):</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon positions:\t&#39;</span> + </div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs not spliced do not have exonic positions&#39;</span> +</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon positions:\t&#39;</span> + </div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs not spliced that have exonic positions: &#39;</span> +</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                  str( not_spl_positions ) +</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                                                         </div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="comment"># Check that all the ORFs that are spliced have at least two &quot;exons&quot;</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        spl_several_exons = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( ( DSORF.spliced == <span class="keyword">True</span> ),</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                                                                                             ( DSORF.spliced_parts_count &lt; 2 ) ).count()</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="keywordflow">if</span> ( spl_several_exons == 0 ):</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon number:\t&#39;</span> + </div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                  <span class="stringliteral">&#39;All DSORF spliced have at least two exons&#39;</span> + </div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon number:\t&#39;</span> + </div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs spliced that do not have several exons: &#39;</span> + </div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                                  str( spl_several_exons ) + </div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                                                         </div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="comment"># Check raw genomic lengths are positive</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        raw_gen_len_pos = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( DSORF.raw_genomic_length &lt; 0 ).count()</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">if</span> ( raw_gen_len_pos == 0 ):</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Raw genomic lengths:\t&#39;</span> + </div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs have a positive raw genomic length&#39;</span> + </div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Genomic lengths:\t&#39;</span> + </div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs that have a negative raw genomic length: &#39;</span> + </div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                  str( raw_gen_len_pos ) + </div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                                                         </div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="comment"># Check genomic lengths are positive</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        gen_len_pos = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( DSORF.genomic_length &lt; 0 ).count()</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">if</span> ( gen_len_pos == 0 ):</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Genomic lengths:\t&#39;</span> + </div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs have a positive genomic length&#39;</span> + </div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Genomic lengths:\t&#39;</span> + </div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs that have a negative genomic length: &#39;</span> + </div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                                  str( gen_len_pos ) + </div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        </div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="comment"># Check coherence of exon locations</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment"># - For positive raw_strand</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        all_dsorfs_plus_raw_strand = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( DSORF.raw_strand == <span class="stringliteral">&#39;+&#39;</span>,</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                                                                                      DSORF.spliced == <span class="keyword">True</span>,</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                                                                                      DSORF.raw_splice_starts != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                                                                                      DSORF.raw_splice_starts != Constants.REPLACE_TOO_LONG_STRINGS,</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                                                                                      DSORF.raw_splice_ends != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                                                                                      DSORF.raw_splice_ends != Constants.REPLACE_TOO_LONG_STRINGS ).all()</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        wrong_order_count = 0</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        wrong_order_ids = []</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        </div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">for</span> dsorf <span class="keywordflow">in</span> all_dsorfs_plus_raw_strand:</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            </div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            start_list = dsorf.raw_splice_starts.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            end_list = dsorf.raw_splice_ends.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            </div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            start_end_list = []</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range( len( start_list ) ):</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                start_end_list += [ start_list[ k ], end_list[ k ] ]</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            start_end_list = map( int, start_end_list )</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                </div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">if</span> ( start_end_list != sorted( start_end_list ) ):</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                wrong_order_count += 1</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                wrong_order_ids.append( str( dsorf.id ) )</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                </div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">if</span> ( wrong_order_count == 0 ):</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (DSORFs on + raw strand):\t&#39;</span> + </div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs on + raw strand have their raw spliced positions in the increasing order&#39;</span> + </div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (DSORFs on + raw strand):\t&#39;</span> + </div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs on + raw strand for which the raw spliced positions are&#39;</span> +</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                  <span class="stringliteral">&#39; not in the increading order:&#39;</span> + str( wrong_order_count ) + </div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                                  <span class="stringliteral">&#39;, DSORF ids: &#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( wrong_order_ids ) +</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            </div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment"># - For negative raw_strand</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        all_dsorfs_neg_raw_strand = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( DSORF.raw_strand == <span class="stringliteral">&#39;-&#39;</span>,</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                                                                                                     DSORF.spliced == <span class="keyword">True</span>,</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                                                                                     DSORF.raw_splice_starts != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                                                                                     DSORF.raw_splice_starts != Constants.REPLACE_TOO_LONG_STRINGS,</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                                                                                     DSORF.raw_splice_ends != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                                                                                     DSORF.raw_splice_ends != Constants.REPLACE_TOO_LONG_STRINGS ).all()</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        wrong_order_count = 0</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        wrong_order_ids = []</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        </div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">for</span> dsorf <span class="keywordflow">in</span> all_dsorfs_neg_raw_strand:</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            </div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            start_list = dsorf.raw_splice_starts.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            end_list = dsorf.raw_splice_ends.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            </div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            start_end_list = []</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range( len( start_list ) ):</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                start_end_list += [ start_list[ k ], end_list[ k ] ]</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            start_end_list = map( int, start_end_list )</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                </div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordflow">if</span> ( start_end_list != sorted( start_end_list, reverse = <span class="keyword">True</span> ) ):</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                wrong_order_count += 1</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                wrong_order_ids.append( str( dsorf.id ) )</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                </div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        <span class="keywordflow">if</span> ( wrong_order_count == 0 ):</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (DSORFs on - raw strand):\t&#39;</span> + </div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs on - raw strand have their raw spliced positions in the decreasing order&#39;</span> + </div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (DSORFs on - raw strand):\t&#39;</span> + </div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs on - raw strand for which the raw spliced positions are&#39;</span> +</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                                  <span class="stringliteral">&#39; not in the decreasing order:&#39;</span> + str( wrong_order_count ) + </div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                                  <span class="stringliteral">&#39;, DSORF ids: &#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( wrong_order_ids ) +</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            </div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="comment"># - For positive strand</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        all_dsorfs_plus_strand = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( DSORF.strand == <span class="stringliteral">&#39;+&#39;</span>,</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                                                                                                  DSORF.spliced == <span class="keyword">True</span>,</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                                                                                                  DSORF.splice_starts != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                                                                                  DSORF.splice_starts != Constants.REPLACE_TOO_LONG_STRINGS,</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                                                                                  DSORF.splice_ends != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                                                                                                  DSORF.splice_ends != Constants.REPLACE_TOO_LONG_STRINGS ).all()</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        wrong_order_count = 0</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        wrong_order_ids = []</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        </div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">for</span> dsorf <span class="keywordflow">in</span> all_dsorfs_plus_strand:</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            </div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            start_list = dsorf.splice_starts.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            end_list = dsorf.splice_ends.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            </div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            start_end_list = []</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range( len( start_list ) ):</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                start_end_list += [ start_list[ k ], end_list[ k ] ]</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            start_end_list = map( int, start_end_list )</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                </div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">if</span> ( start_end_list != sorted( start_end_list ) ):</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                wrong_order_count += 1</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                wrong_order_ids.append( str( dsorf.id ) )</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                </div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="keywordflow">if</span> ( wrong_order_count == 0 ):</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (DSORFs on + strand):\t&#39;</span> + </div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs on + strand have their spliced positions in the increasing order&#39;</span> + </div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (DSORFs on + strand):\t&#39;</span> + </div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs on + strand for which the spliced positions are&#39;</span> +</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                                  <span class="stringliteral">&#39; not in the increasing order:&#39;</span> + str( wrong_order_count ) + </div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                                  <span class="stringliteral">&#39;, DSORF ids: &#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( wrong_order_ids ) +</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            </div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="comment"># - For negative strand</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        all_dsorfs_neg_strand = SQLManagerDS.get_instance().get_session().query( DSORF ).filter( DSORF.strand == <span class="stringliteral">&#39;-&#39;</span>,</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                                                                                 DSORF.spliced == <span class="keyword">True</span>,</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                                                                                 DSORF.splice_starts != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                                                                                 DSORF.splice_starts != Constants.REPLACE_TOO_LONG_STRINGS,</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                                                                                                 DSORF.splice_ends != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                                                                                 DSORF.splice_ends != Constants.REPLACE_TOO_LONG_STRINGS ).all()</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        wrong_order_count = 0</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        wrong_order_ids = []</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        </div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">for</span> dsorf <span class="keywordflow">in</span> all_dsorfs_neg_strand:</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            </div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            start_list = dsorf.splice_starts.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            end_list = dsorf.splice_ends.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            </div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            start_end_list = []</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range( len( start_list ) ):</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                start_end_list += [ start_list[ k ], end_list[ k ] ]</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            start_end_list = map( int, start_end_list )</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                </div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <span class="keywordflow">if</span> ( start_end_list != sorted( start_end_list, reverse = <span class="keyword">True</span> ) ):</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                wrong_order_count += 1</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                wrong_order_ids.append( str( dsorf.id ) )</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                </div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">if</span> ( wrong_order_count == 0 ):</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (DSORFs on - strand):\t&#39;</span> + </div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                  <span class="stringliteral">&#39;All DSORFs on - strand have their spliced positions in the decreasing order&#39;</span> + </div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (DSORFs on - strand):\t&#39;</span> + </div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFs on - strand for which the spliced positions are&#39;</span> +</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                                  <span class="stringliteral">&#39; not in the decreasing order:&#39;</span> + str( wrong_order_count ) + </div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                                  <span class="stringliteral">&#39;, DSORF ids: &#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( wrong_order_ids ) +</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        </div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        </div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="comment"># DSTranscript table</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="comment"># ------------------</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;\n---\t&#39;</span> + <span class="stringliteral">&#39;Assessment of the consistency the DSTranscript table content&#39;</span> )</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        </div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment"># Check there are no raw_end_pos lower than the corresponding raw_start_pos </span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        raw_start_gt_end = SQLManagerDS.get_instance().get_session().query( DSTranscript ).filter( DSTranscript.raw_start_pos &gt;= DSTranscript.raw_end_pos ).count()</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">if</span> ( raw_start_gt_end == 0 ):</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Raw positions:\t&#39;</span> + </div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                                  <span class="stringliteral">&#39;All DSTranscripts have the raw start position lower than the raw end position&#39;</span> + </div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Raw positions:\t&#39;</span> + </div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                                  <span class="stringliteral">&#39;Number of DSTranscripts for which the raw start position is greater&#39;</span> +</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                                  <span class="stringliteral">&#39; than the raw end position: &#39;</span> + str( raw_start_gt_end ) + </div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        </div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="comment"># Check there are no end_pos lower than the corresponding start_pos </span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        start_gt_end = SQLManagerDS.get_instance().get_session().query( DSTranscript ).filter( DSTranscript.start_pos &gt;= DSTranscript.end_pos ).count()</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">if</span> ( start_gt_end == 0 ):</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Positions:\t&#39;</span> + </div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                                  <span class="stringliteral">&#39;All DSTranscripts have the start position lower than the end position&#39;</span> + </div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Positions:\t&#39;</span> + </div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                                  <span class="stringliteral">&#39;Number of DSTranscripts for which the start position is greater&#39;</span> +</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                                  <span class="stringliteral">&#39; than the end position: &#39;</span> + </div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                                  str( start_gt_end ) + </div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        </div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="comment"># Check there are no raw_cds_stop_pos lower than the corresponding raw_cds_start_pos </span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        raw_cds_start_gt_stop = SQLManagerDS.get_instance().get_session().query( DSTranscript ).filter( DSTranscript.raw_cds_start_pos &gt;= DSTranscript.raw_cds_stop_pos ).count()</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">if</span> ( raw_cds_start_gt_stop == 0 ):</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Raw CDS positions:\t&#39;</span> + </div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                  <span class="stringliteral">&#39;All DSTranscripts have the raw CDS start position lower&#39;</span> +</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                  <span class="stringliteral">&#39; than the raw CDS stop position&#39;</span> + </div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Raw CDS positions:\t&#39;</span> + </div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                                  <span class="stringliteral">&#39;Number of DSTranscripts for which the raw start position is greater&#39;</span> +</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                                  <span class="stringliteral">&#39; than the raw CDS stop position: &#39;</span> + </div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                                  str( raw_cds_start_gt_stop ) + </div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        </div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="comment"># Check there are no cds_stop_pos lower than the corresponding cds_start_pos </span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        cds_start_gt_stop = SQLManagerDS.get_instance().get_session().query( DSTranscript ).filter( DSTranscript.cds_start_pos &gt;= DSTranscript.cds_stop_pos ).count()</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span> ( cds_start_gt_stop == 0 ):</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;CDS positions:\t&#39;</span> + </div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                                  <span class="stringliteral">&#39;All DSTranscripts have the CDS start position lower than the CDS stop position&#39;</span> + </div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;CDS positions:\t&#39;</span> + </div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                                  <span class="stringliteral">&#39;Number of DSTranscripts for which the CDS start position is greater&#39;</span> +</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                                  <span class="stringliteral">&#39; than the CDS stop position: &#39;</span> + </div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                                  str( cds_start_gt_stop ) + </div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            </div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="comment"># Check the list of RNA biotypes</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        rna_biotype_list = SQLManagerDS.get_instance().get_session().query( DSTranscript.rna_biotype ).filter( DSTranscript.rna_biotype != <span class="keywordtype">None</span> ).distinct().all()</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        rna_biotype_list = sorted( GeneralUtil.query_result_to_list( rna_biotype_list ) )</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of RNA biotypes:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( rna_biotype_list ) + </div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                              <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                </div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                </div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="comment"># DSORFTranscriptAsso table</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="comment"># -------------------------</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;---\t&#39;</span> + <span class="stringliteral">&#39;Assessment of the consistency the DSORFTranscriptAsso table content&#39;</span> )</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        </div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="comment"># Check the nucleic and amino acid lengths are consistent</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        orf_len_cons = SQLManagerDS.get_instance().get_session().query( DSORFTranscriptAsso ).filter(</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                                                                                        DSORFTranscriptAsso.orf_length != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                                                                                                        DSORFTranscriptAsso.orf_length_nt != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                                                                                                        ( ( DSORFTranscriptAsso.orf_length + 1 ) *3 != DSORFTranscriptAsso.orf_length_nt ) </div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                                                                                                    ).count()</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">if</span> ( orf_len_cons == 0 ):</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Lengths:\t&#39;</span> + </div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                                  <span class="stringliteral">&#39;All DSORFTranscriptAsso have their nucleic lengths consistent with&#39;</span> +</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                  <span class="stringliteral">&#39; their lengths in amino acids&#39;</span> + </div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Lengths:\t&#39;</span> + </div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                                  <span class="stringliteral">&#39;Number of DSORFTranscriptAsso for which nucleic lengths is not &#39;</span> +</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                                  <span class="stringliteral">&#39; consistent with the amino acid length: &#39;</span> + str( orf_len_cons ) + </div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                </div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        </div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="comment"># Gene table</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="comment"># ----------</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;\n---\t&#39;</span> + <span class="stringliteral">&#39;Assessment of the consistency the Gene table content&#39;</span> )</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        </div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="comment"># Check the list of chromosomes</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        chr_list = SQLManagerDS.get_instance().get_session().query( Gene.chromosome ).filter( Gene.chromosome != <span class="keywordtype">None</span> ).distinct().all()</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        chr_list = sorted( GeneralUtil.query_result_to_list( chr_list ) )</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of chromosomes:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( chr_list ) + </div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                              <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )               </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    </div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    </div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="a90bfe18c025200af6d54c3105dad3a58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90bfe18c025200af6d54c3105dad3a58">&#9670;&nbsp;</a></span>assess_PRO_consistency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AssessDatabaseContentStrategy.AssessDatabaseContentStrategy.assess_PRO_consistency </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>assess_PRO_consistency </h2>
<p>This method allows to check the consistency of the data contained in the PRO database. </p>
<div class="fragment"><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keyword">def </span>assess_PRO_consistency( self ):</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                </div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment"># ORF table</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="comment"># ---------</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;---\t&#39;</span> + <span class="stringliteral">&#39;Assessment of the consistency the ORF table content&#39;</span> )</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        </div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="comment"># Check the list of chromosomes</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        chr_list = SQLManagerPRO.get_instance().get_session().query( ORF.chromosome ).distinct().all()</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        chr_list = sorted( GeneralUtil.query_result_to_list( chr_list ) )</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of chromosomes:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( chr_list ) + <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                </div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <span class="comment"># Check the list of strands</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        strand_list = SQLManagerPRO.get_instance().get_session().query( ORF.strand ).filter( ORF.strand != <span class="keywordtype">None</span> ).distinct().all()</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;        strand_list = sorted( GeneralUtil.query_result_to_list( strand_list ) )</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">if</span> ( set( strand_list ).issubset( [ <span class="stringliteral">&#39;+&#39;</span>, <span class="stringliteral">&#39;-&#39;</span> ] ) ):</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Strands:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( strand_list ) + <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Strands:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( strand_list ) + <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                </div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="comment"># Check there are no stop_pos lower than the corresponding start_pos </span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        start_gt_stop = SQLManagerPRO.get_instance().get_session().query( ORF ).filter( ORF.start_pos &gt;= ORF.stop_pos ).count()</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">if</span> ( start_gt_stop == 0 ):</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Positions:\t&#39;</span> + </div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                                  <span class="stringliteral">&#39;All ORFs have the start position lower than the stop position&#39;</span> + </div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> ) </div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Positions:\t&#39;</span> + </div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                                  <span class="stringliteral">&#39;Number of ORFs for which the start position is greater than the&#39;</span> +</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                                  <span class="stringliteral">&#39; stop position: &#39;</span> + str( start_gt_stop ) + </div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        </div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="comment"># Check that all the ORFs that are not spliced have one single &quot;exon&quot;</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        not_spl_single_exon = SQLManagerPRO.get_instance().get_session().query( ORF ).filter( ( ORF.spliced == <span class="keyword">False</span> ), </div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                                                                              ( ORF.spliced_parts_count != 1 ) ).count()</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">if</span> ( not_spl_single_exon == 0 ):</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon number:\t&#39;</span> + </div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                                  <span class="stringliteral">&#39;All ORFs not spliced have a single exon&#39;</span> + </div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon number:\t&#39;</span> + </div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                                  <span class="stringliteral">&#39;Number of ORFs not spliced that have more than one single exon: &#39;</span> +</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                                  str( not_spl_single_exon ) + </div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            </div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="comment"># Check that all the ORFs that are not spliced do not have any spliced positions</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        not_spl_positions = SQLManagerPRO.get_instance().get_session().query( ORF ).filter( ( ORF.spliced == <span class="keyword">False</span> ),</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                                                                            or_( ( ORF.splice_starts != <span class="keywordtype">None</span> ),</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                                                                                                 ( ORF.splice_ends != <span class="keywordtype">None</span> ) ) ).count()</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">if</span> ( not_spl_positions == 0 ):</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon positions:\t&#39;</span> + </div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                                  <span class="stringliteral">&#39;All ORFs not spliced do not have any exonic positions&#39;</span> +</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon positions:\t&#39;</span> + </div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                  <span class="stringliteral">&#39;Number of ORFs not spliced that have exonic positions: &#39;</span> +</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                  str( not_spl_positions ) +</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                                                                         </div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="comment"># Check that all the ORFs that are spliced have at least two &quot;exons&quot;</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        spl_several_exons = SQLManagerPRO.get_instance().get_session().query( ORF ).filter( ( ORF.spliced == <span class="keyword">True</span> ),</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                                                                                            ( ORF.spliced_parts_count &lt; 2 ) ).count()</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">if</span> ( spl_several_exons == 0 ):</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon number:\t&#39;</span> + </div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                                  <span class="stringliteral">&#39;All ORF spliced have at least two exons&#39;</span> + </div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Splicing / Exon number:\t&#39;</span> + </div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                                  <span class="stringliteral">&#39;Number of ORFs spliced that do not have exons: &#39;</span> + </div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                  str( spl_several_exons ) + </div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                                                                         </div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="comment"># Check genomic lengths are positive</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        gen_len_pos = SQLManagerPRO.get_instance().get_session().query( ORF ).filter( ORF.genomic_length &lt; 0 ).count()</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="keywordflow">if</span> ( gen_len_pos == 0 ):</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Genomic lengths:\t&#39;</span> + </div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                                  <span class="stringliteral">&#39;All ORFs have a positive genomic length&#39;</span> + </div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Genomic lengths:\t&#39;</span> + </div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                                  <span class="stringliteral">&#39;Number of ORFs that have a negative genomic length: &#39;</span> + </div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                                  str( gen_len_pos ) + </div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        </div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="comment"># Check coherence of exon locations</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="comment"># - For positive strand</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        all_dsorfs_plus_strand = SQLManagerPRO.get_instance().get_session().query( ORF ).filter( ORF.strand == <span class="stringliteral">&#39;+&#39;</span>,</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                                                                                                 ORF.spliced == <span class="keyword">True</span>,</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                                                                                                 ORF.splice_starts != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                                                                                                 ORF.splice_starts != Constants.REPLACE_TOO_LONG_STRINGS,</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                                                                                                 ORF.splice_ends != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                                                                                                 ORF.splice_ends != Constants.REPLACE_TOO_LONG_STRINGS ).all()</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        wrong_order_count = 0</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        wrong_order_ids = []</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        </div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keywordflow">for</span> dsorf <span class="keywordflow">in</span> all_dsorfs_plus_strand:</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            </div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            start_list = dsorf.splice_starts.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            end_list = dsorf.splice_ends.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            </div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            start_end_list = []</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range( len( start_list ) ):</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                start_end_list += [ start_list[ k ], end_list[ k ] ]</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            start_end_list = map( int, start_end_list )</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                </div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <span class="keywordflow">if</span> ( start_end_list != sorted( start_end_list ) ):</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                wrong_order_count += 1</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                wrong_order_ids.append( str( dsorf.id ) )</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                </div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="keywordflow">if</span> ( wrong_order_count == 0 ):</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (ORFs on + strand):\t&#39;</span> + </div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                                  <span class="stringliteral">&#39;All ORFs on + strand have their spliced positions in the increasing order&#39;</span> + </div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (ORFs on + strand):\t&#39;</span> + </div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                  <span class="stringliteral">&#39;Number of ORFs on + strand for which the spliced positions are&#39;</span> +</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                                  <span class="stringliteral">&#39; not in the increasing order:&#39;</span> + str( wrong_order_count ) + </div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                                  <span class="stringliteral">&#39;, ORF ids: &#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( wrong_order_ids ) +</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            </div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="comment"># - For negative strand</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        all_dsorfs_neg_strand = SQLManagerPRO.get_instance().get_session().query( ORF ).filter( ORF.strand == <span class="stringliteral">&#39;-&#39;</span>,</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                                                                                                ORF.spliced == <span class="keyword">True</span>,</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                                                                                ORF.splice_starts != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                                                                                                ORF.splice_starts != Constants.REPLACE_TOO_LONG_STRINGS,</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                                                                                ORF.splice_ends != <span class="keywordtype">None</span>,</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                                                                                ORF.splice_ends != Constants.REPLACE_TOO_LONG_STRINGS ).all()</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        wrong_order_count = 0</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        wrong_order_ids = []</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        </div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keywordflow">for</span> dsorf <span class="keywordflow">in</span> all_dsorfs_neg_strand:</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            </div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            start_list = dsorf.splice_starts.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            end_list = dsorf.splice_ends.split( Constants.ORF_SPLICING_COORD_SEPARATOR )</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            </div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            start_end_list = []</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <span class="keywordflow">for</span> k <span class="keywordflow">in</span> range( len( start_list ) ):</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                start_end_list += [ start_list[ k ], end_list[ k ] ]</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            start_end_list = map( int, start_end_list )</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                </div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <span class="keywordflow">if</span> ( start_end_list != sorted( start_end_list, reverse = <span class="keyword">True</span> ) ):</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                wrong_order_count += 1</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                wrong_order_ids.append( str( dsorf.id ) )</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                </div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">if</span> ( wrong_order_count == 0 ):</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (ORFs on - strand):\t&#39;</span> + </div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                                  <span class="stringliteral">&#39;All ORFs on - strand have their spliced positions in the decreasing order&#39;</span> + </div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Spliced position (ORFs on - strand):\t&#39;</span> + </div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                                  <span class="stringliteral">&#39;Number of ORFs on - strand for which the spliced positions are&#39;</span> +</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                  <span class="stringliteral">&#39; not in the decreasing order:&#39;</span> + str( wrong_order_count ) + </div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                                  <span class="stringliteral">&#39;, ORF ids: &#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( wrong_order_ids ) +</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        </div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        </div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="comment"># Transcript table</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <span class="comment"># ----------------</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;\n---\t&#39;</span> + <span class="stringliteral">&#39;Assessment of the consistency the Transcript table content&#39;</span> )</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        </div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="comment"># Check there are no end_pos lower than the corresponding start_pos </span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        start_gt_end = SQLManagerPRO.get_instance().get_session().query( Transcript ).filter( Transcript.start_pos &gt;= Transcript.end_pos ).count()</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">if</span> ( start_gt_end == 0 ):</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Positions:\t&#39;</span> + </div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                                  <span class="stringliteral">&#39;All Transcripts have the start position lower than the end position&#39;</span> + </div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Positions:\t&#39;</span> + </div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                                  <span class="stringliteral">&#39;Number of Transcripts for which the start position is greater&#39;</span> +</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                                  <span class="stringliteral">&#39; than the end position: &#39;</span> + </div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                                  str( start_gt_end ) + </div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        </div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="comment"># Check there are no cds_stop_pos lower than the corresponding cds_start_pos </span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        cds_start_gt_stop = SQLManagerPRO.get_instance().get_session().query( Transcript ).filter( Transcript.cds_start_pos &gt;= Transcript.cds_stop_pos ).count()</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="keywordflow">if</span> ( cds_start_gt_stop == 0 ):</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;CDS positions:\t&#39;</span> + </div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                                  <span class="stringliteral">&#39;All Transcripts have the CDS start position lower than the CDS stop position&#39;</span> + </div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;CDS positions:\t&#39;</span> + </div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                                  <span class="stringliteral">&#39;Number of Transcripts for which the CDS start position is greater&#39;</span> +</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                                  <span class="stringliteral">&#39; than the CDS stop position: &#39;</span> + </div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                                  str( cds_start_gt_stop ) + </div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        </div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="comment"># Check there are no rel_cds_stop_pos lower than the corresponding rel_cds_start_pos </span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        rel_cds_start_gt_stop = SQLManagerPRO.get_instance().get_session().query( Transcript ).filter( Transcript.rel_cds_start_pos &gt;= Transcript.rel_cds_stop_pos ).count()</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">if</span> ( rel_cds_start_gt_stop == 0 ):</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;CDS relative positions:\t&#39;</span> + </div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                  <span class="stringliteral">&#39;All Transcripts have the CDS relative start position lower than the&#39;</span> +</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                                  <span class="stringliteral">&#39; CDS relative stop position&#39;</span> + </div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;CDS relative positions:\t&#39;</span> + </div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                                  <span class="stringliteral">&#39;Number of Transcripts for which the CDS relative start position is greater&#39;</span> +</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                                  <span class="stringliteral">&#39; than the CDS relative stop position: &#39;</span> + </div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                                  str( rel_cds_start_gt_stop ) + </div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        </div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        </div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="comment"># ORFTranscriptAsso table</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        <span class="comment"># -----------------------</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;\n---\t&#39;</span> + <span class="stringliteral">&#39;Assessment of the consistency the ORFTranscriptAsso table content&#39;</span> )</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        </div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="comment"># Check there are no rel_stop_pos lower than the corresponding rel_start_pos </span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        rel_start_gt_stop = SQLManagerPRO.get_instance().get_session().query( ORFTranscriptAsso ).filter( ORFTranscriptAsso.rel_start_pos &gt;= ORFTranscriptAsso.rel_stop_pos ).count()</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordflow">if</span> ( rel_start_gt_stop == 0 ):</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Relative positions:\t&#39;</span> + </div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                                  <span class="stringliteral">&#39;All ORFTranscriptAsso entries have the relative start position lower&#39;</span> +</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                                  <span class="stringliteral">&#39; than the relative stop position&#39;</span> + </div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                                  <span class="stringliteral">&#39;\t[OK]&#39;</span> )</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            self.add_to_log_file( <span class="stringliteral">&#39;Relative positions:\t&#39;</span> + </div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                                  <span class="stringliteral">&#39;Number of ORFTranscriptAsso entries for which the relative start&#39;</span> +</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                                  <span class="stringliteral">&#39; position is greater than the relative stop position: &#39;</span> + </div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                                  str( rel_start_gt_stop ) + </div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                                  <span class="stringliteral">&#39;\t[ERROR]&#39;</span> )</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                </div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        </div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="comment"># UTRNABiotypeCatalog table</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="comment"># -------------------------</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        rna_biotype_list = SQLManagerPRO.get_instance().get_session().query( UTRNABiotypeCatalog.biotype ).all()</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        rna_biotype_list = sorted( GeneralUtil.query_result_to_list( rna_biotype_list ) )</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of RNA biotypes:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( rna_biotype_list ) + </div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                              <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                </div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        </div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="comment"># PROGene table</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="comment"># -------------</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;\n---\t&#39;</span> + <span class="stringliteral">&#39;Assessment of the consistency the PROGene table content&#39;</span> )</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        </div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="comment"># Check the list of chromosomes</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        chr_list = SQLManagerPRO.get_instance().get_session().query( PROGene.chromosome ).filter( PROGene.chromosome != <span class="keywordtype">None</span> ).distinct().all()</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        chr_list = sorted( GeneralUtil.query_result_to_list( chr_list ) )</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of chromosomes:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( chr_list ) + </div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                              <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                </div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        </div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="comment"># ProvidedCategoryCatalog table</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <span class="comment"># -----------------------------</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;\n---\t&#39;</span> + <span class="stringliteral">&#39;Assessment of the consistency the ORF categories, cell context and FLOSS classes&#39;</span> )</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        prov_category_list = SQLManagerPRO.get_instance().get_session().query( ProvidedCategoryCatalog.category ).all()</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        prov_category_list = GeneralUtil.query_result_to_list( prov_category_list )</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of (provided) ORF categories:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( prov_category_list ) + </div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                              <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                </div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        </div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="comment"># CellContextCatalog table</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="comment"># ------------------------</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        cell_context_list = SQLManagerPRO.get_instance().get_session().query( CellContextCatalog.context ).all()</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        cell_context_list = GeneralUtil.query_result_to_list( cell_context_list )</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of cell contexts:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( cell_context_list ) + </div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                              <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                </div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        </div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="comment"># FLOSSClassCatalog table</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="comment"># -----------------------</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        floss_class_list = SQLManagerPRO.get_instance().get_session().query( FLOSSClassCatalog.floss_class ).all()</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        floss_class_list = GeneralUtil.query_result_to_list( floss_class_list )</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of FLOSS classes:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( floss_class_list ) + </div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                              <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                </div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        </div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="comment"># ORFCategoryCatalog table</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="comment"># ------------------------</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        orf_category_list = SQLManagerPRO.get_instance().get_session().query( ORFCategoryCatalog.category ).all()</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        orf_category_list = GeneralUtil.query_result_to_list( orf_category_list )</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        self.add_to_log_file( <span class="stringliteral">&#39;List of (computed) ORF categories:\t&#39;</span> + <span class="stringliteral">&#39;, &#39;</span>.join( orf_category_list ) + </div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                              <span class="stringliteral">&#39;\t[TO CHECK]&#39;</span> )</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                </div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="aef021d8eb2149afd6efb3867cd50c91a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef021d8eb2149afd6efb3867cd50c91a">&#9670;&nbsp;</a></span>execute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AssessDatabaseContentStrategy.AssessDatabaseContentStrategy.execute </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>execute </h2>
<p>Execute the strategy to assess the consistency of the database.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When the database provided does not follow the expected model. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keyword">def </span>execute( self ):</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                </div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="comment"># Set the connection to the database</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        self.get_sqlmanager_instance().set_db_settings( self.db_settings )</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="comment"># Check the integrity of the database</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        str_ok = self.get_sqlmanager_instance().check_database_str_integrity()</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">if</span> ( <span class="keywordflow">not</span> str_ok ):</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;The schema of the database provided does not follow&#39;</span> +</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                       <span class="stringliteral">&#39; the expected model. Please make sure the provided model (&#39;</span> + </div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                       self.db_model + <span class="stringliteral">&#39;) and the database (&#39;</span> + </div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                       self.db_settings[ Constants.DB_SETTINGS_DB_NAME ] +</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                                       <span class="stringliteral">&#39;) provided are the right ones.&#39;</span> )</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        </div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        self.init_log_file()</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        </div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment"># Check the consistency according to the model</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span> ( self.db_model == OptionConstants.DATABASE_DECLARATIVE_DS ):</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            self.assess_DS_consistency()</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            </div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">elif</span> ( self.db_model == OptionConstants.DATABASE_DECLARATIVE_PRO ):</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            self.assess_PRO_consistency()                </div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    </div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    </div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="a36525738220b7a1248ed8a9085f4f5cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36525738220b7a1248ed8a9085f4f5cc">&#9670;&nbsp;</a></span>get_sqlmanager_instance()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AssessDatabaseContentStrategy.AssessDatabaseContentStrategy.get_sqlmanager_instance </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>get_sqlmanager_instance </h2>
<p>Return the appropriate SQLManager instance.</p>
<dl class="section return"><dt>Returns</dt><dd>SQLManager instance corresponding to the database model used. </dd></dl>
<div class="fragment"><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keyword">def </span>get_sqlmanager_instance( self ):</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        </div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        sqlmanager_class = eval( <span class="stringliteral">&#39;SQLManager&#39;</span> + self.db_model )</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        </div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        <span class="keywordflow">return</span> sqlmanager_class.get_instance()</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        </div></div><!-- fragment -->
</div>
</div>
<a id="a1f3e0db5a03b71fc8c55d652755d34d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f3e0db5a03b71fc8c55d652755d34d1">&#9670;&nbsp;</a></span>init_log_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AssessDatabaseContentStrategy.AssessDatabaseContentStrategy.init_log_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ext</em> = <code>'.tsv'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>init_log_file </h2>
<p>This method allows to erase any existing log file and to create a new one.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ext</td><td>String - The extension of the file. ".tsv" by default. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keyword">def </span>init_log_file( self, ext=&#39;.tsv&#39; ):</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="comment"># Create the output folder if it does not yet exist</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="comment"># (and its parent folders if necessary)</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">if</span> ( <span class="keywordflow">not</span> os.path.isdir( self.output_folder ) ):</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            os.makedirs( self.output_folder )</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        </div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        file_path = os.path.join( self.output_folder, self.file_name + ext )</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        </div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        Logger.get_instance().info( <span class="stringliteral">&#39; The logs will be saved in &#39;</span> + file_path + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        </div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        file = open( file_path, mode = <span class="stringliteral">&#39;w&#39;</span> )</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        file.close()</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    </div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/mnt/NAS7/Workspace/choteaus/tagc-uorf/project/01_ORF_datafreeze/06_src/fr/tagc/uorf/core/execution/AssessDatabaseContentStrategy.py</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
