<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sORFdatafreezer: fr.tagc.uorf.core.execution.AnnotateORFStrategy.AnnotateORFStrategy Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sORFdatafreezer
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>fr</b></li><li class="navelem"><b>tagc</b></li><li class="navelem"><b>uorf</b></li><li class="navelem"><b>core</b></li><li class="navelem"><b>execution</b></li><li class="navelem"><b>AnnotateORFStrategy</b></li><li class="navelem"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy.html">AnnotateORFStrategy</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">fr.tagc.uorf.core.execution.AnnotateORFStrategy.AnnotateORFStrategy Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Inherits object.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac8218c12d9f62faf507299dc9e3acc83"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy.html#ac8218c12d9f62faf507299dc9e3acc83">__init__</a> (self)</td></tr>
<tr class="separator:ac8218c12d9f62faf507299dc9e3acc83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2aa8cd65194e9aba26d2c57bfa56dd6"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy.html#ad2aa8cd65194e9aba26d2c57bfa56dd6">parse_config</a> (self)</td></tr>
<tr class="separator:ad2aa8cd65194e9aba26d2c57bfa56dd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9534cd3f073e7792d5448e5241e4ae14"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy.html#a9534cd3f073e7792d5448e5241e4ae14">execute</a> (self)</td></tr>
<tr class="separator:a9534cd3f073e7792d5448e5241e4ae14"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac46b082eddc3791e8cf039ba4b9a5a90"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy.html#ac46b082eddc3791e8cf039ba4b9a5a90">compute_orf_category</a> (self)</td></tr>
<tr class="separator:ac46b082eddc3791e8cf039ba4b9a5a90"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cc2c051c0836efd5c18d5ad674521be"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy.html#a3cc2c051c0836efd5c18d5ad674521be">compute_orf_annotation</a> (self)</td></tr>
<tr class="separator:a3cc2c051c0836efd5c18d5ad674521be"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a43a1316a03bf97124b13a4b031aa3cc7"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy.html#a43a1316a03bf97124b13a4b031aa3cc7">batch_insert_to_PRO_db</a> (objects_to_insert, processfile, process='Undefined process')</td></tr>
<tr class="separator:a43a1316a03bf97124b13a4b031aa3cc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy.html">AnnotateORFStrategy</a> </h1>
<p>This class is a strategy aiming to:</p><ul>
<li>Complete the ORFCategory table using solely the information provided by the datasources.</li>
<li>Complete the ORFAnnotation table (i.e. compute the ORF class) using both the information provided by the datasource (ORF coordinates and related transcript) and the information about the transcript (CDS coordinates, eventually download). </li>
</ul>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ac8218c12d9f62faf507299dc9e3acc83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8218c12d9f62faf507299dc9e3acc83">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AnnotateORFStrategy.AnnotateORFStrategy.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>Constructor of <a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1AnnotateORFStrategy_1_1AnnotateORFStrategy.html">AnnotateORFStrategy</a> </h2>
<p>Instance variables:</p><ul>
<li>compute_category: Boolean - Compute the ORF categories from datasource categories?</li>
<li>compute_annotation: Boolean - Annotate ORFs using both datasource and transcript information?</li>
<li>configfile: String - The path to the config file.</li>
<li>orf_category_corresp: Dictionary - The dictionary that associates to lists of provided ORF categories (list of strings - values of the dictionary) the computed ORF categories (strings - keys of the dictionary).</li>
<li>force_overwrite: Boolean - Does the computation need to be performed again? If True all the entries of the tables that need to be computed (i.e. all the entries of the ORFCategory and ORFCategoryCatalog tables or all the entries of the ORFAnnotation and ORFAnnotationCatalog tables will be deleted and the content of these tables will be computed again).</li>
</ul>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When the config file is not provided or cannot be found at the path provided. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">def </span>__init__( self ):</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        </div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        self.compute_category = OptionManager.get_instance().get_option( OptionConstants.OPTION_ANNOTATE_ORF_FROM_PROV,</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                                                         not_none = <span class="keyword">False</span> )</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        </div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        self.compute_annotation = OptionManager.get_instance().get_option( OptionConstants.OPTION_ANNOTATE_ORF_FROM_COORD,</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                                                                           not_none = <span class="keyword">False</span> )</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        configfile = OptionManager.get_instance().get_option( OptionConstants.OPTION_CONFIG_FILE_PATH, </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                                                              not_none = <span class="keyword">True</span> )</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            </div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">if</span> configfile:</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            self.configfile = configfile</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="keywordflow">if</span> ( <span class="keywordflow">not</span> os.path.exists( configfile ) ):</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;No config file may be found at the path provided (&#39;</span> + </div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                                           self.configfile + <span class="stringliteral">&#39;).&#39;</span> )</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            self.parse_config()</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            </div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;A config file has to be provided.&#39;</span> +</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                                       <span class="stringliteral">&#39; See the documentation for more information.&#39;</span> )</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            </div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="comment"># Check if the forceOverwrite option has been selected</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">if</span> OptionManager.get_instance().get_option( OptionConstants.OPTION_FORCE_OVERWRITE, not_none = <span class="keyword">False</span> ):</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            self.force_overwrite = <span class="keyword">True</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            self.force_overwrite = <span class="keyword">False</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        </div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a43a1316a03bf97124b13a4b031aa3cc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43a1316a03bf97124b13a4b031aa3cc7">&#9670;&nbsp;</a></span>batch_insert_to_PRO_db()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AnnotateORFStrategy.AnnotateORFStrategy.batch_insert_to_PRO_db </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>objects_to_insert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>processfile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>process</em> = <code>'Undefined&#160;process'</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<h2>batch_insert_to_PRO_db </h2>
<p>This method allows to insert a list of objects in the database. Large sets of objects are split into several batches which are inserted one at a time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">objects_to_insert</td><td>List - The list of objects to insert in the database. </td></tr>
    <tr><td class="paramname">processfile</td><td>String - The name of the file in which save the objects that are expected to be inserted. </td></tr>
    <tr><td class="paramname">process</td><td>String - The name of the process that generated this list. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="keyword">def </span>batch_insert_to_PRO_db( objects_to_insert, processfile, process=&#39;Undefined process&#39; ):</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        </div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="comment"># Save into a temporary file the data that should be inserted.</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="comment"># This allows to recover the data later if an exception is raised during </span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="comment"># the insertion, saving thus the computation time.</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            FileHandlerUtil.save_obj_to_file( objects_to_save = objects_to_insert,</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                                              filename = processfile,</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                                              output_folder = Constants.ANNOTATE_DATA_FOLDER )</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            Logger.get_instance().error( <span class="stringliteral">&#39;AnnotateORFStrategy.batch_insert_to_PRO_db():&#39;</span> +</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                                         <span class="stringliteral">&#39; An error occurred trying to save data from &#39;</span> + process + </div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                                         <span class="stringliteral">&#39;: \n&#39;</span> + str( e ) +</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                                         <span class="stringliteral">&#39; Error code: &#39;</span> + LogCodes.ERR_FILEHAND + <span class="stringliteral">&#39;.&#39;</span>,</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                                         ex = <span class="keyword">False</span> )</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        </div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        SQLManagerPRO.get_instance().batch_insert_to_db( objects_to_insert = objects_to_insert,</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                                         process = process )</div></div><!-- fragment -->
</div>
</div>
<a id="a3cc2c051c0836efd5c18d5ad674521be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cc2c051c0836efd5c18d5ad674521be">&#9670;&nbsp;</a></span>compute_orf_annotation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AnnotateORFStrategy.AnnotateORFStrategy.compute_orf_annotation </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>compute_orf_annotation </h2>
<p>This method allows to compute the "annotations" of the ORFTranscriptAsso entries using the ORF and transcript coordinates provided by the data sources and/or previously download.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>- When an error occurs while trying to delete the ORFAnnotationCatalog entries (when the "-f" option has been selected). </td></tr>
    <tr><td class="paramname">DenCellORFException</td><td>- When one "computed" annotation term is belonging to several families. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">def </span>compute_orf_annotation( self ):</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        </div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        Logger.get_instance().info( <span class="stringliteral">&#39;Starting the computation of the ORF annotations using&#39;</span> +</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                    <span class="stringliteral">&#39; the information from the ORF and Transcript tables.&#39;</span> )</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        </div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="comment"># First, reset the ORFAnnotation and ORFAnnotationCatalog table contents if necessary</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="keywordflow">if</span> self.force_overwrite:</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            orfannotationcatalog_query = SQLManagerPRO.get_instance().get_session().query( ORFAnnotationCatalog )</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            orfannotationcatalog_count = orfannotationcatalog_query.count()</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            </div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="keywordflow">if</span> ( orfannotationcatalog_count != 0 ):</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            </div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                Logger.get_instance().info( str( orfannotationcatalog_count ) + </div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                            <span class="stringliteral">&#39; entries have been found in the ORFAnnotationCatalog table&#39;</span> +</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                                            <span class="stringliteral">&#39; and will be deleted prior to the computation of ORF annotations.&#39;</span> )</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                </div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                entries_to_delete_str = <span class="stringliteral">&#39;, &#39;</span>.join( [ oac.annotation <span class="keywordflow">for</span> oac <span class="keywordflow">in</span> orfannotationcatalog_query.all() ] )</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                <span class="keywordflow">try</span>:</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                    orfannotationcatalog_query.delete( synchronize_session = <span class="stringliteral">&#39;fetch&#39;</span> )</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                    SQLManagerPRO.get_instance().commit()</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                    <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;AnnotateORFStrategy.compute_orf_annotation():&#39;</span> +</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                               <span class="stringliteral">&#39; An error occurred trying to remove the following&#39;</span> +</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                               <span class="stringliteral">&#39; ORFAnnotationCatalog entries from the session&#39;</span> +</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                               <span class="stringliteral">&#39; and to commit changes: &#39;</span> + entries_to_delete_str + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                    </div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            SQLManagerPRO.get_instance().close_session()</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        </div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            </div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            </div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="comment"># Annotate the ORF, using:</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="comment"># - Length criteria</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="comment"># - Transcript biotype</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="comment"># - CDS coordinates (when the transcript harbors a CDS and </span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="comment">#   the coordinates have been registered in the database)  </span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          </div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="comment"># The correspondences between the biotype categories and the &quot;computed annotation&quot;</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="comment"># is registered as a dictionary, such as the keys are the &quot;computed annotations&quot;</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="comment"># and the values are lists of existing biotypes for which the annotation should </span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="comment"># be used.</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="comment"># Using this dictionary, prepare a dictionary (annotation_dict) that associates </span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment"># to each provided biotype its computed annotation(s).</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        annotation_dict = {}</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordflow">for</span> ( orf_annotation, rna_biotype ) <span class="keywordflow">in</span> Constants.ORF_BIOTYPE_ANNOT_CORRESP.items():</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keywordflow">for</span> biotype <span class="keywordflow">in</span> rna_biotype:</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                </div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                existing_biotype = annotation_dict.get( biotype )</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                <span class="keywordflow">if</span> existing_biotype:</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    existing_biotype.append( orf_annotation )</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                    annotation_dict[ biotype ] = [ orf_annotation ]</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    </div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                    </div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="comment"># The correspondences between the &quot;computed annotations&quot; and the &quot;family&quot; to which</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="comment"># they belong is registered as a dictionary, such as the keys are the &quot;families&quot; and</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="comment"># the values are lists of existing &quot;computed annotation&quot;.</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="comment"># Using this dictionary, prepare a dictionary (annotation_family_dict) that associates</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="comment">#  to each computed annotation the family to which it belongs.</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        annotation_family_dict = {}</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">for</span> ( annot_family, orf_annotation ) <span class="keywordflow">in</span> Constants.ORF_ANNOTATION_CATALOG_FAMILY_CORRESP.items():</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">for</span> orf_annot <span class="keywordflow">in</span> set( orf_annotation ):</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                </div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <span class="comment"># Each annotation term can only belong to ONE single family.</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                <span class="comment"># Hence if this is not the case raise an exception.</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                existing_orf_annot = annotation_family_dict.get( orf_annot )</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                <span class="keywordflow">if</span> existing_orf_annot:</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                    <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;AnnotateORFStrategy.compute_orf_annotation():&#39;</span> +</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                                               <span class="stringliteral">&#39; The computed annotation term &quot;&#39;</span> + orf_annot + </div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                                               <span class="stringliteral">&#39;&quot; has been found belonging to at least two families (&#39;</span> +</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                               existing_orf_annot + <span class="stringliteral">&#39;, &#39;</span> + annot_family + </div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                               <span class="stringliteral">&#39;). Each annotation term can only belong to one single family!&#39;</span> +</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                               <span class="stringliteral">&#39; Please check the ORF_ANNOTATION_CATALOG_TYPE_CORRESP dictionary&#39;</span> +</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                                               <span class="stringliteral">&#39; defined in the Constants file (&#39;</span> + </div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                                               str( ORF_ANNOTATION_CATALOG_TYPE_CORRESP ) + <span class="stringliteral">&#39;).&#39;</span> )</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    annotation_family_dict[ orf_annot ] = annot_family</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                    </div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    </div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        all_orfannotation_catalog = []</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        objects_to_insert = []</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        </div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="comment"># The annotations are computed using information from the ORF and Transcript tables.</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="comment"># NB: It may be necessary to run the ComputeMissingInfo strategy to recover missing</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="comment">#     information in the Transcript table (CDS coordinates, transcript biotype...)</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        all_orftranscriptasso_query = SQLManagerPRO.get_instance().get_session().query( ORFTranscriptAsso )</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        all_orftranscriptasso = all_orftranscriptasso_query.all()</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        </div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="comment"># Get the number total number of entries expected to be treated and </span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment"># reset the ProgressionBar instance to follow the progression</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        ProgressionBar.get_instance().reset_instance( total = all_orftranscriptasso_query.count() )</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        </div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        </div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="comment"># For each entry of the ORFTranscriptAsso table, create the necessary entries </span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="comment"># in the ORFAnnotation and ORFAnnotationCategory tables</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">for</span> orftranscriptasso <span class="keywordflow">in</span> all_orftranscriptasso:</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                        </div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <span class="comment"># Update and display the progression bar on the console</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            ProgressionBar.get_instance().increase_and_display()</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            </div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="comment"># Get the related ORF entry</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            orf = SQLManagerPRO.get_instance().get_session().query( ORF ).filter( ORF.id == orftranscriptasso.orf_id ).one()</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            </div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            <span class="comment"># Get the related Transcript entry</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            transcript = SQLManagerPRO.get_instance().get_session().query( Transcript ).filter( Transcript.id == orftranscriptasso.transcript_id ).one()</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            SQLManagerPRO.get_instance().close_session()</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            </div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <span class="comment"># Annotate short ORFs</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            <span class="comment"># If the maximal length in amino acid (ORFTranscriptAsso entry) is below the threshold,</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="comment"># then annotate the ORF as short ORF</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            max_aa_len = orftranscriptasso.length_aa_max </div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordflow">if</span> orf.genomic_length: </div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                orf_gen_len_aa = float( orf.genomic_length ) / 3</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                orf_gen_len_aa = <span class="keywordtype">None</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            annotation = Constants.ORF_ANNOTATION_SHORT_ORF</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            </div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="keywordflow">if</span> ( max_aa_len <span class="keywordflow">and</span> ( max_aa_len &lt;= self.short_orf_threshold ) ):</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                </div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                orfannotation = ORFAnnotation( orftranscriptasso_id = orftranscriptasso.id,</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                                               orf_annotation = annotation,</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                                               criteria = Constants.ANNOTATE_CRITERIA_MAX_AA_LEN )</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                objects_to_insert.append( orfannotation )</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                </div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                <span class="comment"># If the annotation used has not been yet registered in the </span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                <span class="comment"># ORFAnnotationCatalog table, then add it</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                <span class="keywordflow">if</span> ( annotation <span class="keywordflow">not</span> <span class="keywordflow">in</span> all_orfannotation_catalog ):</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                    all_orfannotation_catalog.append( annotation )</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                    orfannotationcatalog = ORFAnnotationCatalog( annotation = annotation,</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                                                                 family = annotation_family_dict[ annotation ] )</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                    objects_to_insert.append( orfannotationcatalog )</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            <span class="comment"># If the exonic sum length of the related ORF entry is </span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;            <span class="comment"># below the threshold, then annotate the ORF as short ORF</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;            <span class="keywordflow">if</span> ( orf_gen_len_aa <span class="keywordflow">and</span> ( orf_gen_len_aa &lt;= self.short_orf_threshold ) ):</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                </div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                orfannotation = ORFAnnotation( orftranscriptasso_id = orftranscriptasso.id,</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                               orf_annotation = annotation,</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                               criteria = Constants.ANNOTATE_CRITERIA_EXONIC_LEN )</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                objects_to_insert.append( orfannotation )</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                </div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                <span class="comment"># If the annotation used has not been yet registered in the </span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                <span class="comment"># ORFAnnotationCatalog table, then add it</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                <span class="keywordflow">if</span> ( annotation <span class="keywordflow">not</span> <span class="keywordflow">in</span> all_orfannotation_catalog ):</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                    all_orfannotation_catalog.append( annotation )</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                    orfannotationcatalog = ORFAnnotationCatalog( annotation = annotation,</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                                                 family = annotation_family_dict[ annotation ] )</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                    objects_to_insert.append( orfannotationcatalog )</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                 </div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            </div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <span class="comment"># If the biotype of the transcript provides information about the ORF class,</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="comment"># add entries to the ORFAnnotation table</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="comment"># Get the annotation(s) corresponding to the biotype</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            annotation_rel_to_biotype = annotation_dict.get( transcript.rna_biotype )</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            </div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <span class="keywordflow">if</span> annotation_rel_to_biotype:</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                <span class="keywordflow">for</span> annotation <span class="keywordflow">in</span> annotation_rel_to_biotype:</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                    orfannotation = ORFAnnotation( orftranscriptasso_id = orftranscriptasso.id,</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                                                   orf_annotation = annotation,</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                                   criteria = Constants.ANNOTATE_CRITERIA_BIOTYPE )</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                    objects_to_insert.append( orfannotation )</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                    </div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    <span class="comment"># If the annotation used has not been yet registered in the </span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                    <span class="comment"># ORFAnnotationCatalog table, then add it</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                    <span class="keywordflow">if</span> ( annotation <span class="keywordflow">not</span> <span class="keywordflow">in</span> all_orfannotation_catalog ):</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                        all_orfannotation_catalog.append( annotation )</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                        orfannotationcatalog = ORFAnnotationCatalog( annotation = annotation,</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                                                                     family = annotation_family_dict[ annotation ] )</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                        objects_to_insert.append( orfannotationcatalog )</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            </div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            </div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <span class="comment"># If the transcript harbors a CDS (i.e. an annotated ORF) and </span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="comment"># the information is registered about the CDS coordinates in </span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="comment"># the database, then compute the ORF annotations.</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            </div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="comment"># Check both the Transcript and the ORF entries are located on the same strand</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordflow">if</span> ( ( transcript.strand != <span class="keywordtype">None</span> )</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                 <span class="keywordflow">and</span> ( orf.strand != <span class="keywordtype">None</span> ) ):</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                <span class="keywordflow">if</span> ( transcript.strand == orf.strand ):</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                    orf_transcript_on_same_str = <span class="keyword">True</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                    orf_transcript_on_same_str = <span class="keyword">False</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                    Logger.get_instance().warning( <span class="stringliteral">&#39;The ORF with ID &quot;&#39;</span> + str( orf.id ) + </div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                                                   <span class="stringliteral">&#39;&quot; is located on the &#39;</span> + orf.strand + <span class="stringliteral">&#39; strand,&#39;</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                                                   <span class="stringliteral">&#39; while its related transcript (ID &quot;&#39;</span> + </div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                                   str( transcript.id ) + <span class="stringliteral">&#39;&quot;) is located on the &#39;</span> + </div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                                                   transcript.strand + <span class="stringliteral">&#39; strand&#39;</span> +</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                                   <span class="stringliteral">&#39; (ORFTranscriptAsso ID: &quot;&#39;</span> + str( orftranscriptasso.id ) + </div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                                                   <span class="stringliteral">&#39;&quot;).&#39;</span> +</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                                   <span class="stringliteral">&#39; Warning code: &#39;</span> + LogCodes.WARN_ORFANNOT_CONFL_STRD + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                orf_transcript_on_same_str = <span class="keywordtype">None</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                </div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                </div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            <span class="comment"># Get all the annotations that could be given to the ORF as a list</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            annotation_list = []</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            </div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            <span class="comment"># Log an error if (a part of the) ORF is located </span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            <span class="comment"># outside of its transcript</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <span class="keywordflow">if</span> ( ( transcript.start_pos != <span class="keywordtype">None</span> ) </div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                 <span class="keywordflow">and</span> ( transcript.end_pos != <span class="keywordtype">None</span> ) </div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                 <span class="keywordflow">and</span> ( ( transcript.start_pos &gt; orf.start_pos )</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                       <span class="keywordflow">or</span> ( orf.stop_pos &gt; transcript.end_pos ) ) ):</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                Logger.get_instance().error( <span class="stringliteral">&#39;The ORF with ID &quot;&#39;</span> + str( orf.id ) +</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                                             <span class="stringliteral">&#39;&quot;&quot; has been found associated with the transcript with ID &quot;&#39;</span> +</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                             str( transcript.id ) + <span class="stringliteral">&#39;&quot; (biotype: &#39;</span> + transcript.rna_biotype +</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                                             <span class="stringliteral">&#39;, ORFTranscriptAsso ID: &quot;&#39;</span> + str( orftranscriptasso.id )+ </div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                                             <span class="stringliteral">&#39;&quot;) whilst the ORF coordinates (&#39;</span> + str( orf.start_pos ) + <span class="stringliteral">&#39;-&#39;</span> +</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                                             str( orf.stop_pos ) + <span class="stringliteral">&#39;) are outside of the transcript bounds (&#39;</span> +</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                             str( transcript.start_pos ) + <span class="stringliteral">&#39;-&#39;</span> + str( transcript.end_pos ) +</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                                             <span class="stringliteral">&#39;).&#39;</span> +</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                                             <span class="stringliteral">&#39; Error code: &#39;</span> + LogCodes.ERR_ORF_ANNOT_CONFL_POS_OUT + <span class="stringliteral">&#39;.&#39;</span>, </div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                                             ex  = <span class="keyword">False</span> )</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                </div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            <span class="comment"># If the CDS coordinates are avaiable and the ORF is located on the </span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="comment"># transcript, then annotate the ORF using the CDS coordinates</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keywordflow">elif</span> ( ( transcript.cds_start_pos != <span class="keywordtype">None</span> )</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                   <span class="keywordflow">and</span> ( transcript.cds_stop_pos != <span class="keywordtype">None</span> ) ):</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                </div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                <span class="comment"># Perform the annotation in the case where the ORF </span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                <span class="comment"># and the Transcript are located on same strand</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                <span class="keywordflow">if</span> orf_transcript_on_same_str:</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    </div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    <span class="keywordflow">if</span> ( orf.strand == <span class="stringliteral">&#39;+&#39;</span> ):</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                        </div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                        <span class="comment"># Annotate the ORFs with a start codon located upstream</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                        <span class="comment"># of the CDS start codon</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                        <span class="keywordflow">if</span> ( orf.start_pos &lt; transcript.cds_start_pos ):</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                            </div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                            <span class="comment"># If the ORF start codon is located upstream of the CDS start codon,</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                            <span class="comment"># and the ORF stop codon is located upstream of the CDS stop codon,</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                            <span class="comment"># then annotate the ORF as upstream</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                            <span class="keywordflow">if</span> ( orf.stop_pos &lt;= transcript.cds_stop_pos ):</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_UPSTREAM )</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                                </div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                                <span class="comment"># Moreover, if the ORF stop codon is located in the CDS,</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                                <span class="comment"># then annotate the ORF as overlapping</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                                <span class="keywordflow">if</span> ( ( orf.stop_pos &gt; transcript.cds_start_pos )</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                                     <span class="keywordflow">and</span> ( orf.stop_pos &lt;= transcript.cds_stop_pos ) ):</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                                    annotation_list.append( Constants.ORF_ANNOTATION_OVERLAP )</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                                    </div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                            <span class="comment"># If the ORF start codon is located upstream of the CDS start codon,</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                            <span class="comment"># and the ORF stop codon is located downstream of the CDS stop codon,</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                            <span class="comment"># then annotate the ORF as new CDS</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_NEW_CDS )</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                                </div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                        <span class="comment"># Annotate the ORFs with both the start and stop codons </span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                        <span class="comment"># located in the CDS</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                        <span class="keywordflow">elif</span> ( ( orf.start_pos &gt;= transcript.cds_start_pos )</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                               <span class="keywordflow">and</span> ( orf.stop_pos &lt;= transcript.cds_stop_pos ) ):</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                            </div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                            <span class="comment"># If the ORF stop codon is located at the CDS stop codon,</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                            <span class="comment"># then the ORF is the annotated CDS</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                            <span class="keywordflow">if</span> ( orf.stop_pos == transcript.cds_stop_pos ):</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_CDS )</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                            </div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                            <span class="comment"># If the ORF stop codon is located upstream of the CDS </span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                            <span class="comment"># stop codon, then the ORF is annotated as overlapping</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                            <span class="comment"># and as &quot;in CDS&quot;</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                                annotation_list += [ Constants.ORF_ANNOTATION_OVERLAP,</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                                                     Constants.ORF_ANNOTATION_IN_CDS ]</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                        </div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                        <span class="comment"># Annotate the ORFs with a stop codon located downstream</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                        <span class="comment"># of the CDS stop codon</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                        <span class="keywordflow">elif</span> ( orf.stop_pos &gt; transcript.cds_stop_pos ):</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                            </div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                            <span class="comment"># If the ORF start codon is located downstream of the CDS start codon,</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                            <span class="comment"># and stop codon is located downstream of the CDS stop codon</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                            <span class="comment"># then annotate the ORF as downstream</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                            <span class="keywordflow">if</span> ( orf.start_pos &gt; transcript.cds_start_pos ):</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_DOWNSTREAM )</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                </div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                <span class="comment"># Moreover, if the ORF start codon is located in the CDS,</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                <span class="comment"># then annotate the ORF as overlapping</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                <span class="keywordflow">if</span> ( orf.start_pos &lt; transcript.cds_stop_pos ):</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                    annotation_list.append( Constants.ORF_ANNOTATION_OVERLAP )</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                    </div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                    </div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                        </div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                        <span class="comment"># Annotate the ORFs with a start codon located upstream</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                        <span class="comment"># of the CDS start codon</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                        <span class="keywordflow">if</span> ( orf.stop_pos &gt; transcript.cds_stop_pos ):</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                            </div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                            <span class="comment"># If the ORF start codon is located upstream of the CDS start codon,</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                            <span class="comment"># and the ORF stop codon is located upstream of the CDS stop codon,</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                            <span class="comment"># then annotate the ORF as upstream</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                            <span class="keywordflow">if</span> ( orf.start_pos &gt;= transcript.cds_start_pos ):</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_UPSTREAM )</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                </div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                                <span class="comment"># Moreover, if the ORF stop codon is located in the CDS,</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                                <span class="comment"># then annotate the ORF as overlapping</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                                <span class="keywordflow">if</span> ( ( orf.start_pos &lt; transcript.cds_stop_pos )</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                                     <span class="keywordflow">and</span> ( orf.start_pos &gt;= transcript.cds_start_pos ) ):</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                    annotation_list.append( Constants.ORF_ANNOTATION_OVERLAP )</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                    </div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                            <span class="comment"># If the ORF start codon is located upstream of the CDS start codon,</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                            <span class="comment"># and the ORF stop codon is located downstream of the CDS stop codon,</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                            <span class="comment"># then annotate the ORF as new CDS</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_NEW_CDS )</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                                </div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                        <span class="comment"># Annotate the ORFs with both the start and stop codons </span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                        <span class="comment"># located in the CDS</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                        <span class="keywordflow">elif</span> ( ( orf.stop_pos &lt;= transcript.cds_stop_pos )</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                               <span class="keywordflow">and</span> ( orf.start_pos &gt;= transcript.cds_start_pos ) ):</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                            </div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                            <span class="comment"># If the ORF stop codon is located at the CDS stop codon,</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                            <span class="comment"># then the ORF is the annotated CDS</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                            <span class="keywordflow">if</span> ( orf.start_pos == transcript.cds_start_pos ):</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_CDS )</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                            </div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                            <span class="comment"># If the ORF stop codon is located upstream of the CDS </span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                            <span class="comment"># stop codon, then the ORF is annotated as overlapping</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                            <span class="comment"># and as &quot;in CDS&quot;</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                annotation_list += [ Constants.ORF_ANNOTATION_OVERLAP,</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                                                     Constants.ORF_ANNOTATION_IN_CDS ]</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                        </div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                        <span class="comment"># Annotate the ORFs with a stop codon located downstream</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                        <span class="comment"># of the CDS stop codon</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                        <span class="keywordflow">elif</span> ( orf.start_pos &lt; transcript.cds_start_pos ):</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                            </div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                            <span class="comment"># If the ORF start codon is located downstream of the CDS start codon,</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                            <span class="comment"># and stop codon is located downstream of the CDS stop codon</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                            <span class="comment"># then annotate the ORF as downstream</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                            <span class="keywordflow">if</span> ( orf.stop_pos &lt; transcript.cds_stop_pos ):</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_DOWNSTREAM )</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                </div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                                <span class="comment"># Moreover, if the ORF start codon is located in the CDS,</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                                <span class="comment"># then annotate the ORF as overlapping</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                                <span class="keywordflow">if</span> ( orf.stop_pos &gt; transcript.cds_start_pos ):</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                                    annotation_list.append( Constants.ORF_ANNOTATION_OVERLAP )</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                                    </div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                        </div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                <span class="comment"># Perform the annotation in the case where the ORF </span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                <span class="comment"># and the Transcript are located on opposite strands</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="keywordflow">elif</span> ( orf_transcript_on_same_str == <span class="keyword">False</span> ):</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                    </div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                    annotation_list.append( Constants.ORF_ANNOTATION_OPPOSITE )</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                    </div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    <span class="comment"># Transcript on the &#39;+&#39; strand, ORF located on the &#39;-&#39; strand</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                    <span class="keywordflow">if</span> ( orf.strand == <span class="stringliteral">&#39;-&#39;</span> ):</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                        </div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                        <span class="comment"># Annotate the ORFs with a stop codon located upstream</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                        <span class="comment"># of the CDS start codon</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                        <span class="keywordflow">if</span> ( orf.start_pos &lt; transcript.cds_start_pos ):</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                            </div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                            <span class="comment"># If the ORF stop codon is located upstream of the CDS start codon,</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                            <span class="comment"># and the ORF start codon is located upstream of the CDS stop codon,</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                            <span class="comment"># then annotate the ORF as upstream</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                            <span class="keywordflow">if</span> ( orf.start_pos &lt;= transcript.cds_stop_pos ):</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_UPSTREAM )</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                                </div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                                <span class="comment"># Moreover, if the ORF start codon is located in the CDS,</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                                <span class="comment"># then annotate the ORF as overlapping</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                                <span class="keywordflow">if</span> ( ( orf.stop_pos &gt; transcript.cds_start_pos )</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                                     <span class="keywordflow">and</span> ( orf.stop_pos &lt;= transcript.cds_stop_pos ) ):</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                                    annotation_list.append( Constants.ORF_ANNOTATION_OVERLAP )</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                                    </div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                            <span class="comment"># If the ORF stop codon is located upstream of the CDS start codon,</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                            <span class="comment"># and the ORF start codon is located downstream of the CDS stop codon,</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                            <span class="comment"># then annotate the ORF as new CDS</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_NEW_CDS )</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                                </div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;                        <span class="comment"># Annotate the ORFs with both the start and stop codons </span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                        <span class="comment"># located in the CDS</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                        <span class="keywordflow">elif</span> ( ( orf.start_pos &gt;= transcript.cds_start_pos )</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                               <span class="keywordflow">and</span> ( orf.stop_pos &lt;= transcript.cds_stop_pos ) ):</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                            </div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                            <span class="comment"># If the ORF start codon is located at the CDS stop codon,</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                            <span class="comment"># then the ORF exactly overlap the annotated CDS on the</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                            <span class="comment"># opposite strand</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                            <span class="keywordflow">if</span> ( orf.stop_pos == transcript.cds_stop_pos ):</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_NEW_CDS )</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                            </div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                            <span class="comment"># If the ORF start codon is located upstream of the CDS </span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                            <span class="comment"># stop codon, then the ORF is annotated as overlapping</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                            <span class="comment"># and as &quot;in CDS&quot;</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                                annotation_list += [ Constants.ORF_ANNOTATION_OVERLAP, </div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                                                     Constants.ORF_ANNOTATION_IN_CDS ]</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                        </div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                        <span class="comment"># Annotate the ORFs with a start codon located downstream</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                        <span class="comment"># of the CDS stop codon</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                        <span class="keywordflow">elif</span> ( orf.stop_pos &gt; transcript.cds_stop_pos ):</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                            </div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                            <span class="comment"># If the ORF stop codon is located downstream of the CDS start codon,</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                            <span class="comment"># and the ORF start codon is located downstream of the CDS stop codon</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                            <span class="comment"># then annotate the ORF as downstream</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                            <span class="keywordflow">if</span> ( orf.start_pos &gt; transcript.cds_start_pos ):</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_DOWNSTREAM )</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                </div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                                <span class="comment"># Moreover, if the ORF stop codon is located in the CDS,</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                                <span class="comment"># then annotate the ORF as overlapping</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                                <span class="keywordflow">if</span> ( orf.start_pos &lt; transcript.cds_stop_pos ):</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                                    annotation_list.append( Constants.ORF_ANNOTATION_OVERLAP )</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                                    </div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                    <span class="comment"># Transcript on the &#39;-&#39; strand, ORF located on the &#39;+&#39; strand</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                    <span class="keywordflow">if</span> ( orf.strand == <span class="stringliteral">&#39;+&#39;</span> ):</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                        </div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                        <span class="comment"># Annotate the ORFs with a stop codon located upstream</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                        <span class="comment"># of the CDS start codon</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                        <span class="keywordflow">if</span> ( orf.stop_pos &gt; transcript.cds_stop_pos ):</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                            </div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                            <span class="comment"># If the ORF stop codon is located upstream of the CDS start codon,</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                            <span class="comment"># and the ORF start codon is located upstream of the CDS stop codon,</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                            <span class="comment"># then annotate the ORF as upstream</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                            <span class="keywordflow">if</span> ( orf.start_pos &gt;= transcript.cds_stop_pos ):</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_UPSTREAM )</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                                </div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                                <span class="comment"># Moreover, if the ORF start codon is located in the CDS,</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                <span class="comment"># then annotate the ORF as overlapping</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                <span class="keywordflow">if</span> ( ( orf.start_pos &lt; transcript.cds_start_pos )</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                                     <span class="keywordflow">and</span> ( orf.start_pos &gt;= transcript.cds_start_pos ) ):</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                                    annotation_list.append( Constants.ORF_ANNOTATION_OVERLAP )</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                                    </div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                            <span class="comment"># If the ORF stop codon is located upstream of the CDS start codon,</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                            <span class="comment"># and the ORF start codon is located downstream of the CDS stop codon,</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                            <span class="comment"># then annotate the ORF as new CDS</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_NEW_CDS )</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                                </div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                        <span class="comment"># Annotate the ORFs with both the start and stop codons </span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                        <span class="comment"># located in the CDS</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                        <span class="keywordflow">elif</span> ( ( orf.stop_pos &lt;= transcript.cds_start_pos )</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                               <span class="keywordflow">and</span> ( orf.start_pos &gt;= transcript.cds_stop_pos ) ):</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                            </div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                            <span class="comment"># If the ORF stop codon is located at the CDS stop codon,</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                            <span class="comment"># then the ORF exactly overlap the annotated CDS on the</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                            <span class="comment"># opposite strand</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                            <span class="keywordflow">if</span> ( ( orf.start_pos == transcript.cds_stop_pos )</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                                 <span class="keywordflow">and</span> ( orf.stop_pos == transcript.cds_start_pos ) ):</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_NEW_CDS )</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                            </div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                            <span class="comment"># If the ORF start codon is located upstream of the CDS </span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                            <span class="comment"># stop codon, then the ORF is annotated as overlapping</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                            <span class="comment"># and as &quot;in CDS&quot;</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                                annotation_list += [ Constants.ORF_ANNOTATION_OVERLAP,</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                                                     Constants.ORF_ANNOTATION_IN_CDS ]</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                        </div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                        <span class="comment"># Annotate the ORFs with a start codon located downstream</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                        <span class="comment"># of the CDS stop codon</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                        <span class="keywordflow">elif</span> ( orf.start_pos &lt; transcript.cds_start_pos ):</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                            </div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                            <span class="comment"># If the ORF start codon is located downstream of the CDS stop codon,</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                            <span class="comment"># and ORF stop codon is located downstream of the CDS start codon</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                            <span class="comment"># then annotate the ORF as downstream</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                            <span class="keywordflow">if</span> ( orf.start_pos &lt; transcript.cds_start_pos ):</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                                annotation_list.append( Constants.ORF_ANNOTATION_DOWNSTREAM )</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                                </div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                                <span class="comment"># Moreover, if the ORF stop codon is located in the CDS,</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                                <span class="comment"># then annotate the ORF as overlapping</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                <span class="keywordflow">if</span> ( orf.stop_pos &gt; transcript.cds_start_pos ):</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                    annotation_list.append( Constants.ORF_ANNOTATION_OVERLAP )</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        </div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        </div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                <span class="comment"># If the ORF and the transcript are located on the same strand,</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                <span class="comment"># then check if the ORF start codon is in the same frame than the</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                <span class="comment"># CDS start codon</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                <span class="keywordflow">if</span> orf_transcript_on_same_str:</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                </div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                    start_to_start_dist = abs( orf.start_pos - transcript.cds_start_pos)</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                    </div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                    <span class="keywordflow">if</span> ( ( start_to_start_dist % 3 ) != 0 ):</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                        annotation_list.append( Constants.ORF_ANNOTATION_ALT ) </div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                                    </div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                            </div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <span class="comment"># Add all the annotations to the database</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            <span class="keywordflow">for</span> annotation <span class="keywordflow">in</span> annotation_list:</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                orfannotation = ORFAnnotation( orftranscriptasso_id = orftranscriptasso.id,</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                                               orf_annotation = annotation,</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                                               criteria = Constants.ANNOTATE_CRITERIA_COORD )</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                objects_to_insert.append( orfannotation )</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                </div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                <span class="comment"># If the annotation used has not been yet registered in the </span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                <span class="comment"># ORFAnnotationCatalog table, then add it</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                <span class="keywordflow">if</span> ( annotation <span class="keywordflow">not</span> <span class="keywordflow">in</span> all_orfannotation_catalog ):</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                    all_orfannotation_catalog.append( annotation )</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                    orfannotationcatalog = ORFAnnotationCatalog( annotation = annotation,</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;                                                                 family = annotation_family_dict[ annotation ] )</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                    objects_to_insert.append( orfannotationcatalog )</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                                </div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        self.batch_insert_to_PRO_db( objects_to_insert = objects_to_insert, </div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                                     processfile = <span class="stringliteral">&#39;orf_annotation&#39;</span>,</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                                     process = <span class="stringliteral">&#39;compute_orf_category(): Computation of ORF categories&#39;</span> )</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;               </div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        Logger.get_instance().info( <span class="stringliteral">&#39;The computation of the ORF annotations using the information&#39;</span> +</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                    <span class="stringliteral">&#39; from the ORF and Transcript tables has finished.&#39;</span>)</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        </div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                </div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="ac46b082eddc3791e8cf039ba4b9a5a90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac46b082eddc3791e8cf039ba4b9a5a90">&#9670;&nbsp;</a></span>compute_orf_category()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AnnotateORFStrategy.AnnotateORFStrategy.compute_orf_category </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>compute_orf_category </h2>
<p>This method allows to compute the categories of the ORFTranscriptAsso entries using the categories provided by the data sources.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When an error occurs while trying to delete the ORFCategoryCatalog entries (when the "-f" option has been selected). </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keyword">def </span>compute_orf_category( self ):</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        </div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        Logger.get_instance().info( <span class="stringliteral">&#39;Starting the computation of the ORF categories&#39;</span> +</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                    <span class="stringliteral">&#39; using the categories provided by the datasources.&#39;</span>)</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        </div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="comment"># First, reset the ORFCategory and ORFCategoryCatalog table contents if necessary</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">if</span> self.force_overwrite:</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            orfcategorycatalog_query = SQLManagerPRO.get_instance().get_session().query( ORFCategoryCatalog )</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            orfcategorycatalog_count = orfcategorycatalog_query.count()</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            </div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">if</span> ( orfcategorycatalog_count != 0 ):</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            </div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                Logger.get_instance().info( str( orfcategorycatalog_count ) + </div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                            <span class="stringliteral">&#39; entries have been found in the ORFCategoryCatalog table&#39;</span> +</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                                            <span class="stringliteral">&#39; and will be deleted prior to the computation of ORF categories.&#39;</span> )</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                </div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                entries_to_delete_str = <span class="stringliteral">&#39;, &#39;</span>.join( [ occ.category <span class="keywordflow">for</span> occ <span class="keywordflow">in</span> orfcategorycatalog_query.all() ] )</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordflow">try</span>:</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    orfcategorycatalog_query.delete( synchronize_session = <span class="stringliteral">&#39;fetch&#39;</span> )</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    SQLManagerPRO.get_instance().commit()</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                    <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;AnnotateORFStrategy.compute_orf_category():&#39;</span> +</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                                               <span class="stringliteral">&#39; An error occurred trying to remove the following&#39;</span> +</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                               <span class="stringliteral">&#39; ORFCategoryCatalog entries from the session&#39;</span> +</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                               <span class="stringliteral">&#39; and to commit changes: &#39;</span> + entries_to_delete_str + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    </div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            SQLManagerPRO.get_instance().close_session()</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        </div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        objects_to_insert = []</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        </div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="comment"># The correspondences between the provided categories and the &quot;computed&quot; ones is expected to</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment"># be provided as a dictionary, such as the keys are the &quot;computed&quot; categories and the values</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="comment"># are lists of provided categories corresponding to them.</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="comment"># Using this dictionary, prepare a dictionary (prov_cat) that associate </span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment"># to each provided category its computed categorie(s).</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        category_dict = {}</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">for</span> ( comp_cat, prov_categories ) <span class="keywordflow">in</span> self.orf_category_corresp.items():</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="keywordflow">for</span> prov_cat <span class="keywordflow">in</span> prov_categories:</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                </div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="comment"># If the provided category has to be ignored, associate it to an empty list</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="keywordflow">if</span> ( ( str( comp_cat ) == <span class="stringliteral">&#39;None&#39;</span> ) </div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                     <span class="keywordflow">and</span> ( comp_cat == Constants.ORF_ANNOTATION_TO_IGNORE ) ):</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    comp_cat_to_add = []</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    comp_cat_to_add = [ comp_cat ]</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                </div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                existing_prov_cat = category_dict.get( prov_cat )</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                <span class="keywordflow">if</span> existing_prov_cat:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                    existing_prov_cat += comp_cat_to_add</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    category_dict[ prov_cat ] = comp_cat_to_add</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        </div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="comment"># For all computed categories, create an entry in the ORFCatagoryCatalog table</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">for</span> comp_cat <span class="keywordflow">in</span> self.orf_category_corresp.keys():</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keywordflow">if</span> ( ( str( comp_cat ) != <span class="stringliteral">&#39;None&#39;</span> ) <span class="keywordflow">and</span> ( comp_cat != Constants.ORF_ANNOTATION_TO_IGNORE ) ):</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                orfcategorycatalog = ORFCategoryCatalog( category = comp_cat )</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                objects_to_insert.append( orfcategorycatalog )</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;         </div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            </div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="comment"># For each entry of the ORFTranscriptAsso table, create the corresponding entries in the ORFCategory table</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        all_orftranscriptasso_query = SQLManagerPRO.get_instance().get_session().query( ORFTranscriptAsso )</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        all_orftranscriptasso = all_orftranscriptasso_query.all()</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        </div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="comment"># Get the number total number of entries expected to be treated and </span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="comment"># reset the ProgressionBar instance to follow the progression</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        ProgressionBar.get_instance().reset_instance( total = all_orftranscriptasso_query.count() )</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        </div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">for</span> orftranscriptasso <span class="keywordflow">in</span> all_orftranscriptasso:</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        </div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="comment"># Update and display the progression bar on the console</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            ProgressionBar.get_instance().increase_and_display()</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            </div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="comment"># Get the list of all the provided categories corresponding to the entry</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            prov_categories = SQLManagerPRO.get_instance().get_session().query( ProvidedCategory.provided_category ).filter( ProvidedCategory.orftranscriptasso_id == orftranscriptasso.id ).all()</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            prov_categories = GeneralUtil.query_result_to_list( prov_categories )</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            </div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="comment"># Get the list of &quot;computed&quot; categories corresponding to these</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            comp_categories = []</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="keywordflow">for</span> prov_cat <span class="keywordflow">in</span> prov_categories:</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                </div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                existing_prov_cat = category_dict.get( prov_cat, <span class="keyword">False</span> )</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                <span class="keywordflow">if</span> ( existing_prov_cat != <span class="keyword">False</span> ):</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                    comp_categories += existing_prov_cat</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                        </div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                    Logger.get_instance().warning( <span class="stringliteral">&#39;The category &quot;&#39;</span> + prov_cat + <span class="stringliteral">&#39;&quot; has been found in the&#39;</span> +</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                                   <span class="stringliteral">&#39; provided categories associated with the ORFTranscriptAsso&#39;</span> +</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                                                   <span class="stringliteral">&#39; with ID &quot;&#39;</span> + str( orftranscriptasso.id ) + </div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                                                   <span class="stringliteral">&#39;&quot;, and this provided category is not associated to any&#39;</span> +</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                                                   <span class="stringliteral">&#39; &quot;computed&quot; category in the dictionary.&#39;</span> +</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                                                   <span class="stringliteral">&#39; Hence, this ORF annotation will not be considered.&#39;</span> +</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                                                   <span class="stringliteral">&#39; Warning code: &#39;</span> + LogCodes.WARN_ORFCAT_PROV_NOTIN_DICT + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            </div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="comment"># For each unique &quot;computed&quot; category, create an entry in the ORFCategory table</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="keywordflow">for</span> comp_cat <span class="keywordflow">in</span> set( comp_categories ):</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                orfcategory = ORFCategory( orftranscriptasso_id = orftranscriptasso.id,</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                                           orf_category = comp_cat )</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                objects_to_insert.append( orfcategory )</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                </div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        SQLManagerPRO.get_instance().close_session()</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    </div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        self.batch_insert_to_PRO_db( objects_to_insert = objects_to_insert,</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                                     processfile = <span class="stringliteral">&#39;orf_category&#39;</span>,</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                                     process = <span class="stringliteral">&#39;compute_orf_category(): Computation of ORF categories&#39;</span> )</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        </div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        Logger.get_instance().info( <span class="stringliteral">&#39;The computation of the ORF categories using the provided&#39;</span> +</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                                    <span class="stringliteral">&#39; categories has finished.&#39;</span>)</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    </div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    </div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    </div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="a9534cd3f073e7792d5448e5241e4ae14"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9534cd3f073e7792d5448e5241e4ae14">&#9670;&nbsp;</a></span>execute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AnnotateORFStrategy.AnnotateORFStrategy.execute </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>execute </h2>
<p>Execute the strategy to compute the ORF categories.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When an exception has been raised whilst checking the PRO database. </td></tr>
    <tr><td class="paramname">DenCellORFException</td><td>When the ORFTranscriptAsso table is empty. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="keyword">def </span>execute( self ):</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                </div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="comment"># Run DatabaseCheck in order to check PRO database is reachable and use</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="comment"># the appropriate models prior to the merging of data.</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        Logger.get_instance().info( <span class="stringliteral">&#39;Checking the PRO database prior to compute missing information...&#39;</span> )</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            DatabaseCheckStrategy().execute()</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39; An error occurred whilst checking the database prior to&#39;</span> +</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                       <span class="stringliteral">&#39; compute missing information.&#39;</span> +</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                       <span class="stringliteral">&#39;\n Error code: &#39;</span> + LogCodes.ERR_DBCHECK + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        </div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        </div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="comment"># Check there is at least one ORFTranscriptAsso entry in the database prior </span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="comment"># to compute the ORF categories / annotations.</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        orftranscriptasso_count = SQLManagerPRO.get_instance().get_session().query( ORFTranscriptAsso ).count()</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> ( orftranscriptasso_count == 0 ):</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;There is not any entry in the ORFTranscriptAsso table of the &#39;</span> + </div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                       SQLManagerPRO.get_instance().db_name + <span class="stringliteral">&#39; database (PRO database).&#39;</span> +</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                       <span class="stringliteral">&#39; Hence, the computation of missing information will be stopped.&#39;</span> )</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        </div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment"># Compute ORF categories</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">if</span> self.compute_category:</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            </div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <span class="comment"># NB: If there is at least one entry in the ORFCategoryCatalog table and the forceOverwrite </span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <span class="comment">#     option has not been selected, then this step will not be performed</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            all_orfcategorycatalog_count = SQLManagerPRO.get_instance().get_session().query( ORFCategoryCatalog ).count()</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            SQLManagerPRO.get_instance().close_session()</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <span class="keywordflow">if</span> ( ( all_orfcategorycatalog_count == 0 ) <span class="keywordflow">or</span> ( self.force_overwrite ) ):</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                self.compute_orf_category()</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                Logger.get_instance().info( <span class="stringliteral">&#39;Entries have been found in the ORFCategoryCatalog table&#39;</span> +</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                            <span class="stringliteral">&#39; and the &quot;forceOverwrite&quot; option has not been selected.&#39;</span> +</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                            <span class="stringliteral">&#39; Hence, the assignment of categories to the ORFs using&#39;</span> +</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                            <span class="stringliteral">&#39; the provided categories will not be performed again.&#39;</span> )</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            </div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            </div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="comment"># Compute the ORF annotations</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">if</span> self.compute_annotation:</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="comment"># NB: If there is at least one entry in the ORFAnnotationCatalog table and the forceOverwrite </span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="comment">#     option has not been selected, then this step will not be performed</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            all_orfannotationcatalog_count = SQLManagerPRO.get_instance().get_session().query( ORFAnnotationCatalog ).count()</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            SQLManagerPRO.get_instance().close_session()</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordflow">if</span> ( ( all_orfannotationcatalog_count == 0 ) <span class="keywordflow">or</span> ( self.force_overwrite ) ):</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                self.compute_orf_annotation()</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                Logger.get_instance().info( <span class="stringliteral">&#39;Entries have been found in the ORFAnnotationCatalog table&#39;</span> +</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                                            <span class="stringliteral">&#39; and the &quot;forceOverwrite&quot; option has not been selected.&#39;</span> +</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                            <span class="stringliteral">&#39; Hence, the annotation of the ORF using ORF and transcript&#39;</span> +</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                            <span class="stringliteral">&#39; information will not be performed again.&#39;</span> )</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    </div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        </div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<a id="ad2aa8cd65194e9aba26d2c57bfa56dd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2aa8cd65194e9aba26d2c57bfa56dd6">&#9670;&nbsp;</a></span>parse_config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.AnnotateORFStrategy.AnnotateORFStrategy.parse_config </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>parse_config </h2>
<p>Parse the config file to retrieve required information.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When the orf_category_corresp string ("cell context dictionary") cannot be converted into a Python dictionary. </td></tr>
    <tr><td class="paramname">DenCellORFException</td><td>When the value provided for the maximal size for an ORF to be considered as short is not a positive integer. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keyword">def </span>parse_config( self ):</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        </div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="comment"># Read the configfile</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        config = ConfigParser.ConfigParser()</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        config.optionxform = <span class="keyword">lambda</span> option: option</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        config.read( self.configfile )</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                </div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="comment"># If necessary, get the dictionary to use to compute the ORF categories</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">if</span> self.compute_category:</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordflow">if</span> config.has_option( Constants.CONFIG_SECTION_ANNOTATE_ORF_PARAMETERS, Constants.CONFIG_SECTION_ANNOTATE_ORF_PARAMETERS_ITEM_CATEGORY_DICT ):</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                self.orf_category_corresp = config.get( Constants.CONFIG_SECTION_ANNOTATE_ORF_PARAMETERS, </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                                                        Constants.CONFIG_SECTION_ANNOTATE_ORF_PARAMETERS_ITEM_CATEGORY_DICT )</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="keywordflow">try</span>:</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    self.orf_category_corresp = eval( self.orf_category_corresp )</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;AnnotateORFStrategy.parse_config():&#39;</span> +</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                                               <span class="stringliteral">&#39; An error occurred trying to convert the category dictionary&#39;</span> +</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                               <span class="stringliteral">&#39; provided as a string into an actual Python dictionary.&#39;</span>, e )</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            </div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                self.orf_category_corresp = Constants.ORF_CATEGORY_CORRESP</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                Logger.get_instance().debug( <span class="stringliteral">&#39;AnnotateORFStrategy.parse_config():&#39;</span> +</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                                             <span class="stringliteral">&#39; As there was no dictionary provided to compute the ORF&#39;</span> +</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                             <span class="stringliteral">&#39; categories in the config file, the default dictionary (&#39;</span> + </div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                             str( Constants.ORF_CATEGORY_CORRESP ) + <span class="stringliteral">&#39;) will be used.&#39;</span> )</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                </div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="comment"># If necessary, get the size threshold that define the short ORFs</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">if</span> self.compute_annotation:</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            </div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordflow">if</span> config.has_option( Constants.CONFIG_SECTION_ANNOTATE_ORF_PARAMETERS, Constants.CONFIG_SECTION_ANNOTATE_ORF_PARAMETERS_ITEM_SHORT_ORF_SIZE_THRESHOLD ):</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                self.short_orf_threshold = config.get( Constants.CONFIG_SECTION_ANNOTATE_ORF_PARAMETERS, </div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                                                       Constants.CONFIG_SECTION_ANNOTATE_ORF_PARAMETERS_ITEM_SHORT_ORF_SIZE_THRESHOLD )</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                <span class="keywordflow">try</span>:</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    self.short_orf_threshold = int( self.short_orf_threshold )</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                    <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;AnnotateORFStrategy.parse_config(): The value for the&#39;</span> +</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                               <span class="stringliteral">&#39; maximal size for an ORF to be considered as short&#39;</span> +</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                                               <span class="stringliteral">&#39; needs to be an integer (provided value: &#39;</span> +</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                                               str( self.short_orf_threshold ) + <span class="stringliteral">&#39;).&#39;</span> )</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                    <span class="keywordflow">if</span> ( self.short_orf_threshold &lt; 0 ):</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;AnnotateORFStrategy.parse_config(): The value for the&#39;</span> +</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                                                   <span class="stringliteral">&#39; maximal size for an ORF to be considered as short&#39;</span> +</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                                   <span class="stringliteral">&#39; needs to be a positive integer (provided value: &#39;</span> +</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                                                   str( self.short_orf_threshold ) + <span class="stringliteral">&#39;).&#39;</span> )</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                self.short_orf_threshold = Constants.DEFAULT_SHORT_ORF_ANNOTATION_SIZE_THRESHOLD</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                Logger.get_instance().debug( <span class="stringliteral">&#39;AnnotateORFStrategy.parse_config(): As there was value for&#39;</span> +</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                             <span class="stringliteral">&#39; the maximal size for an ORF to be considered as short in&#39;</span> +</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                             <span class="stringliteral">&#39; the config file, the default value of &#39;</span> +</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                             str( Constants.DEFAULT_SHORT_ORF_ANNOTATION_SIZE_THRESHOLD ) +</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                             <span class="stringliteral">&#39; will be used.&#39;</span> )</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    </div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    </div></div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/mnt/NAS7/Workspace/choteaus/tagc-uorf/project/01_ORF_datafreeze/06_src/fr/tagc/uorf/core/execution/AnnotateORFStrategy.py</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
