<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>sORFdatafreezer: fr.tagc.uorf.core.execution.InsertionStrategy.InsertionStrategy Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">sORFdatafreezer
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>fr</b></li><li class="navelem"><b>tagc</b></li><li class="navelem"><b>uorf</b></li><li class="navelem"><b>core</b></li><li class="navelem"><b>execution</b></li><li class="navelem"><b>InsertionStrategy</b></li><li class="navelem"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1InsertionStrategy_1_1InsertionStrategy.html">InsertionStrategy</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1InsertionStrategy_1_1InsertionStrategy-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">fr.tagc.uorf.core.execution.InsertionStrategy.InsertionStrategy Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Inherits object.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8f5752dab1b30fdac29cfcbac5fd5322"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1InsertionStrategy_1_1InsertionStrategy.html#a8f5752dab1b30fdac29cfcbac5fd5322">__init__</a> (self)</td></tr>
<tr class="separator:a8f5752dab1b30fdac29cfcbac5fd5322"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fc43a0ce0ec2057a3b12e3856e4ef16"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1InsertionStrategy_1_1InsertionStrategy.html#a0fc43a0ce0ec2057a3b12e3856e4ef16">parse_config</a> (self)</td></tr>
<tr class="separator:a0fc43a0ce0ec2057a3b12e3856e4ef16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a2fd4b461de6ff6b3881154ce9a8629"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1InsertionStrategy_1_1InsertionStrategy.html#a5a2fd4b461de6ff6b3881154ce9a8629">execute</a> (self)</td></tr>
<tr class="separator:a5a2fd4b461de6ff6b3881154ce9a8629"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c55f4c251c8dd021ff4cabbae7b31b5"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1InsertionStrategy_1_1InsertionStrategy.html#a3c55f4c251c8dd021ff4cabbae7b31b5">batch_insert_to_db</a> (self, objects_to_insert, source)</td></tr>
<tr class="separator:a3c55f4c251c8dd021ff4cabbae7b31b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1><a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1InsertionStrategy_1_1InsertionStrategy.html">InsertionStrategy</a> </h1>
<p>This class allows to get the names and paths of all the gene lists and data sources that need to be parsed and inserted in the database (searching for them in the config file) and to perform the insertion of new entries in the database. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a8f5752dab1b30fdac29cfcbac5fd5322"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f5752dab1b30fdac29cfcbac5fd5322">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.InsertionStrategy.InsertionStrategy.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>Constructor of <a class="el" href="classfr_1_1tagc_1_1uorf_1_1core_1_1execution_1_1InsertionStrategy_1_1InsertionStrategy.html">InsertionStrategy</a> </h2>
<p>Instance variables:</p><ul>
<li>configfile: String - The path to the config file.</li>
<li>genelists_dict: Dictionary - A dictionary that associate to each gene list the path to its file.</li>
<li>genelist_order: List - The list containing the order in which the gene lists have to be inserted.</li>
<li>source_dict: Dictionary - A dictionary that associate to each data source the path to its file.</li>
<li>source_order: List - The list containing the order in which the data sources have to be inserted.</li>
</ul>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When the config file is not provided or cannot be found at the path provided. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">def </span>__init__( self ):</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        configfile = OptionManager.get_instance().get_option( OptionConstants.OPTION_CONFIG_FILE_PATH, </div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                                              not_none=<span class="keyword">True</span> )</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="keywordflow">if</span> configfile:</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            self.configfile = configfile</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            <span class="keywordflow">if</span> ( <span class="keywordflow">not</span> os.path.exists( configfile ) ):</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;No config file may be found at the path provided (&#39;</span> + </div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                                           self.configfile + <span class="stringliteral">&#39;).&#39;</span> )</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            self.parse_config()</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;A config file has to be provided.&#39;</span> +</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                                       <span class="stringliteral">&#39; Please see the documentation for more information.&#39;</span> )</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a3c55f4c251c8dd021ff4cabbae7b31b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c55f4c251c8dd021ff4cabbae7b31b5">&#9670;&nbsp;</a></span>batch_insert_to_db()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.InsertionStrategy.InsertionStrategy.batch_insert_to_db </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>objects_to_insert</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>source</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>batch_insert_to_db </h2>
<p>This method allows to insert a list of objects in the database. See the documentation of the SQLManager.batch_insert_to_db() function for more information.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">objects_to_insert</td><td>List - The list of objects to insert in the database. </td></tr>
    <tr><td class="paramname">source</td><td>String - The name of the source from which these objects have been created. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keyword">def </span>batch_insert_to_db( self, objects_to_insert, source ):</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        </div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        Logger.get_instance().debug( <span class="stringliteral">&#39;Starting the insertion of data from &#39;</span> + source + <span class="stringliteral">&#39;.&#39;</span> ) </div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        </div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="comment">#Â Save into a temporary file the data that should be inserted.</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="comment"># This allows to recover the data later if an exception is raised during</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="comment"># the insertion, saving thus the parsing time.</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            FileHandlerUtil.save_obj_to_file( objects_to_save = objects_to_insert,</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                              filename = <span class="stringliteral">&#39;objects_from_&#39;</span> + source, </div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                                              output_folder = Constants.PARSED_DATA_FOLDER )</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            Logger.get_instance().error( <span class="stringliteral">&#39;InsertionStrategy.batch_insert_to_db():&#39;</span> +</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                         <span class="stringliteral">&#39; An error occurred trying to save data from &#39;</span> + </div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                                         source + <span class="stringliteral">&#39;: \n&#39;</span> + str( e ) +</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                                         <span class="stringliteral">&#39; Error code: &#39;</span> + LogCodes.ERR_FILEHAND + <span class="stringliteral">&#39;.&#39;</span>,</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                                         ex = <span class="keyword">False</span> )</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        </div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="comment"># Insert the objects into the database</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        SQLManagerDS.get_instance().batch_insert_to_db( objects_to_insert = objects_to_insert, </div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                                                        process = source )</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;        </div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        Logger.get_instance().debug( <span class="stringliteral">&#39;The insertion of data from &#39;</span> + source + <span class="stringliteral">&#39; has finished.&#39;</span> )</div></div><!-- fragment -->
</div>
</div>
<a id="a5a2fd4b461de6ff6b3881154ce9a8629"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a2fd4b461de6ff6b3881154ce9a8629">&#9670;&nbsp;</a></span>execute()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.InsertionStrategy.InsertionStrategy.execute </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>execute </h2>
<p>Execute the strategy to parse and insert data from gene list and data sources into the database.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When an exception has been raised during the DatabaseCheck. </td></tr>
    <tr><td class="paramname">DenCellORFException</td><td>When an exception has been raised during the parsing of a gene list. </td></tr>
    <tr><td class="paramname">DenCellORFException</td><td>When the Gene table is empty and there is no gene list provided in the config file. </td></tr>
    <tr><td class="paramname">DenCellORFException</td><td>When the DataSource table contains entries whilst the Gene table do not. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keyword">def </span>execute( self ):</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        </div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="comment"># Run DatabaseCheck in order to check the DS database is reachable prior to insertion of data</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        Logger.get_instance().info( <span class="stringliteral">&#39;Checking the database prior to data insertion...&#39;</span> )</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            DatabaseCheckStrategy().execute()</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;An error occurred whilst checking the database prior to&#39;</span> +</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                       <span class="stringliteral">&#39; data insertion.&#39;</span> +</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                         <span class="stringliteral">&#39;\n Error code: &#39;</span> + LogCodes.ERR_DBCHECK + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        </div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="comment"># Process to the insertion of the gene lists. </span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="comment"># NB: The gene lists are only added if there is not any entry in the Gene table.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        </div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment"># Prior to any insertion of data, get all the entries of the DataSource table and </span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment"># store them into the DataManager for a faster and easier access during data parsing</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="comment"># NB: Please see the documentation of the DataManager for more information.</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        DataManager.get_instance().store_DS_query_result( Constants.DM_ALL_DATASOURCES, </div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                                          <span class="stringliteral">&#39;query( DataSource ).all()&#39;</span> )</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                </div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment"># If there is not any Gene entry in the database and not any entry in the </span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="comment"># DataSource table, insert the gene lists provided</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        gene_table_count = SQLManagerDS.get_instance().get_session().query( Gene ).count()</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        SQLManagerDS.get_instance().close_session()</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        </div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">if</span> ( ( gene_table_count == 0 ) </div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;             <span class="keywordflow">and</span> ( DataManager.get_instance().get_data( Constants.DM_ALL_DATASOURCES ) == {} ) ):</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="comment"># Parse and insert the gene lists in the appropriate order</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">if</span> self.genelist_order:</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                </div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                Logger.get_instance().info( <span class="stringliteral">&#39;Starting the insertion of the gene lists.&#39;</span> )</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                </div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <span class="keywordflow">if</span> ( len( self.genelist_order ) &gt; 1 ): </div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                    Logger.get_instance().debug( <span class="stringliteral">&#39;InsertionStrategy.execute(): The gene lists&#39;</span> +</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                                                 <span class="stringliteral">&#39; will be parsed and inserted in the following order: &#39;</span> + </div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                                 <span class="stringliteral">&#39;, &#39;</span>.join( self.genelist_order ) + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                </div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">for</span> gene_list <span class="keywordflow">in</span> self.genelist_order:</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    </div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                    <span class="comment"># Get the corresponding data path</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                    data_path = self.genelists_dict[ gene_list ]</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                    </div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                    <span class="comment"># Instantiate the ParserWrapper</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                        parser_wrapper = ParserWrapper( data_source = gene_list, </div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                                        data_path = data_path )</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                        <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;InsertionStrategy.execute(): An error occurred&#39;</span> +</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                                   <span class="stringliteral">&#39; trying to instantiate the ParserWrapper for&#39;</span> + </div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                                                   <span class="stringliteral">&#39; the gene list &quot;&#39;</span> + gene_list + <span class="stringliteral">&#39;&quot;.&#39;</span>, e )</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                    </div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                    <span class="comment"># Execute the parsing and insertion of genes</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                    Logger.get_instance().info( <span class="stringliteral">&#39;Starting the parsing and the insertion of the gene list &quot;&#39;</span> + </div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                                gene_list + <span class="stringliteral">&#39;&quot;.&#39;</span> )</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                    </div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                    <span class="comment"># Parse the gene list</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                    Logger.get_instance().debug( <span class="stringliteral">&#39;Starting the parsing of the gene list &quot;&#39;</span> + </div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                                 gene_list + <span class="stringliteral">&#39;&quot;.&#39;</span> )</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                        objects_to_insert = parser_wrapper.execute()</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                        <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;InsertionStrategy.execute(): An error occured parsing&#39;</span> +</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                                   <span class="stringliteral">&#39; the gene list &quot;&#39;</span> + gene_list +</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                                     <span class="stringliteral">&#39;&quot;.\n Error code: &#39;</span> + LogCodes.ERR_PARS_PARSING + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    </div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    <span class="comment"># Insert the data parsed</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    self.batch_insert_to_db( objects_to_insert = objects_to_insert, </div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                                             source = gene_list )</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                </div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            </div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="comment"># If there is no gene list provided, raise an exception</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;The database does not contain any entry in the Gene table&#39;</span> +</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                                           <span class="stringliteral">&#39; and there is not any gene lists or cross-reference provided&#39;</span> +</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                           <span class="stringliteral">&#39; in the config file.&#39;</span> )</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                               </div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">elif</span> ( gene_table_count != 0 ):</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            Logger.get_instance().info( <span class="stringliteral">&#39;The Gene table already contains entries.&#39;</span> +</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                        <span class="stringliteral">&#39; Hence the gene lists provided in the config file will not&#39;</span> +</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                        <span class="stringliteral">&#39; be inserted. If you changed the gene lists provided in the config&#39;</span> +</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                        <span class="stringliteral">&#39; file, make sure to overwrite the existing database prior data&#39;</span> +</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                        <span class="stringliteral">&#39; insertion using the &quot;-f&quot; option. Please see the documentation&#39;</span> +</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                        <span class="stringliteral">&#39; for more information.&#39;</span> )</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        </div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;The DataSource table already contains data whilst the Gene table&#39;</span> +</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                       <span class="stringliteral">&#39; does not contain any data! Please contact the developer if you&#39;</span> +</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                       <span class="stringliteral">&#39; see this message.&#39;</span> )</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        </div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                </div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment"># Once the Gene and GeneAlias table are filled in, complete the UTGeneFromAlias table.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="comment"># NB: This table associates to each alias (i.e. entry of the GeneAlias table) its gene ID(s).</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="comment">#     To do this, for a given alias, a first search is performed for the symbol in the list</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="comment">#     of approved symbols. </span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="comment">#         - If no results are found in the list of approved symbols, a search is then performed</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="comment">#           in the whole list of aliases. </span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">#         - If a unique gene is found, its ID is saved in the &quot;gene_ids&quot; attribute.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="comment">#         - If several genes are found matching this alias, these IDs are all concatenated and </span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="comment">#           saved as a string in the &quot;gene_ids&quot; attribute (comma-separated values).</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        utgenefromalias_query = SQLManagerDS.get_instance().get_session().query(UTGeneFromAlias)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        utgenefromalias_count = utgenefromalias_query.count()</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        SQLManagerDS.get_instance().close_session()</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        </div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="comment"># If the UTGeneFromAlias table is empty, fill it in processing data from Gene and GeneAlias tables</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">if</span> ( utgenefromalias_count == 0 ):</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                        </div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            Logger.get_instance().info( <span class="stringliteral">&#39;Starting to match to each unique alias of the GeneAlias table&#39;</span> +</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                                        <span class="stringliteral">&#39; the list of its associated gene IDs. The information will be&#39;</span> +</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                                        <span class="stringliteral">&#39; recorded in the UTGeneFromAlias table.&#39;</span> )</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            </div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <span class="comment"># Get the dictionary that associate to each unique &quot;official&quot; </span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            <span class="comment"># alias of the GeneAlias table its corresponding gene ID(s)</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="comment"># (as a comma-separated list if several gene IDs are associated</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="comment"># to the alias)</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            off_aliases_dict = SQLManagerDS.get_instance().get_session().query( </div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                                                                                GeneAlias.alias, </div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                                                                func.group_concat( GeneAlias.gene_id ) </div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                                                                               ).filter( </div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                                                                                            GeneAlias.alias.like( Constants.ALIAS_OFF_PREFIX  + <span class="stringliteral">&#39;%&#39;</span> ) </div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                                                                                        ).group_by( </div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                                                                                                    GeneAlias.alias </div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                                                                                                    ).all()</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            off_aliases_dict = GeneralUtil.list_of_2tuples_to_dict( off_aliases_dict )</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            </div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="comment"># Get the dictionary that associate to each unique &quot;non official&quot; </span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            <span class="comment"># alias of the GeneAlias table its corresponding gene ID(s)</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            <span class="comment"># (as a comma-separated list if several gene IDs are associated</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="comment"># to the alias)</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            non_off_aliases_dict = SQLManagerDS.get_instance().get_session().query( </div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                                                                                    GeneAlias.alias, </div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                                                                                    func.group_concat( GeneAlias.gene_id ) </div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                                                                                    ).filter( </div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                                                                                                GeneAlias.alias.notlike( Constants.ALIAS_OFF_PREFIX  + <span class="stringliteral">&#39;%&#39;</span> ) </div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                                                                                            ).group_by( </div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                                                                                                        GeneAlias.alias </div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                                                                                                        ).all()</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            non_off_aliases_dict = GeneralUtil.list_of_2tuples_to_dict( non_off_aliases_dict )    </div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            </div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="comment"># Get the list of all the aliases used in the GeneAlias table</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            all_uniq_aliases = SQLManagerDS.get_instance().get_session().query( GeneAlias.alias ).distinct().all()                </div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            all_uniq_aliases = GeneralUtil.query_result_to_list( all_uniq_aliases )</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                        </div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="comment"># Get the number total number of objects expected to be treated and </span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="comment"># reset the ProgressionBar instance to follow the progression</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            ProgressionBar.get_instance().reset_instance( total = len( all_uniq_aliases ) )</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            SQLManagerDS.get_instance().close_session()</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            </div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="comment"># For each unique gene alias, get the list of corresponding gene IDs</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="comment"># and store it in the UTGeneFromAlias table.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            objects_to_insert = []</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordflow">for</span> alias <span class="keywordflow">in</span> all_uniq_aliases:</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                        </div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                <span class="comment"># Update and display the progression bar on the console</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                ProgressionBar.get_instance().increase_and_display()</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                </div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                <span class="comment"># If the alias has not the prefix of an official symbol,</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="comment"># then get the alias with the prefix</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <span class="keywordflow">if</span> ( alias.startswith( Constants.ALIAS_OFF_PREFIX ) ):</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                    alias_with_off = alias</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                    alias_with_off = Constants.ALIAS_OFF_PREFIX + alias</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    </div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <span class="comment"># If the alias exists as an approved / official alias in the </span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <span class="comment"># GeneAlias table, then get the list of gene IDs associated to</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="comment"># it and create a new entry in the UTGeneFromAlias table</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                alias_in_off_dict = off_aliases_dict.get( alias_with_off )</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                <span class="keywordflow">if</span> ( alias_in_off_dict ):</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    utgenefromalias = UTGeneFromAlias( alias = alias, </div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                                                       gene_ids = alias_in_off_dict )</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                    objects_to_insert.append( utgenefromalias )</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                </div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                <span class="comment"># Otherwise, try to get the list of gene IDs that are associated to it.</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                <span class="comment"># If the alias is not register in the dictionary, log a critical error </span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="comment"># as it means the database integrity has been compromised.</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    alias_in_non_off_dict = non_off_aliases_dict.get( alias )</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                    </div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    <span class="keywordflow">if</span> ( alias_in_non_off_dict ):</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                        utgenefromalias = UTGeneFromAlias( alias = alias, </div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                                                           gene_ids = alias_in_non_off_dict )</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                        objects_to_insert.append( utgenefromalias )</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                        </div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                    <span class="keywordflow">else</span>: </div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                        Logger.get_instance().critical( <span class="stringliteral">&#39;InsertionStrategy.get_gene_ids_from_symbol():&#39;</span> +</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                                                <span class="stringliteral">&#39; Unexpected query result: the search for the symbol &#39;</span> + </div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                                                symbol + <span class="stringliteral">&#39; in the list of all symbols from the GeneAlias&#39;</span> +</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                                                <span class="stringliteral">&#39; table returned an empty result. Please contact the&#39;</span> +</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                                                <span class="stringliteral">&#39; developer if you see this message.&#39;</span> )</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            </div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            Logger.get_instance().info( <span class="stringliteral">&#39;The association of each unique aliases of the GeneAlias table&#39;</span> +</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                                        <span class="stringliteral">&#39; to its list of corresponding gene IDs has finished.&#39;</span> )</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            </div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="comment"># Insert these new objects into the database</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            self.batch_insert_to_db( objects_to_insert = objects_to_insert, </div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                                     source = <span class="stringliteral">&#39;UTGeneFromAlias&#39;</span> )</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            </div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            Logger.get_instance().info( <span class="stringliteral">&#39;The UTGeneFromAlias table already contains data.&#39;</span> +</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                        <span class="stringliteral">&#39; Hence, the computation of its content will not be performed again.&#39;</span> )</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            </div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        </div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="comment"># Prior to the insertion of data, get all the entries of the Gene, GeneAlias, </span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="comment"># UTGeneFromAlias and UTDSTranscriptGeneConflict tables and store them into </span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="comment"># the DataManager for a faster and easier access during the parsing</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment"># NB: See the DataManager documentation for more information.        </span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        DataManager.get_instance().store_DS_query_result( Constants.DM_ALL_GENES, </div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                                          <span class="stringliteral">&#39;query( Gene ).all()&#39;</span> )</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        DataManager.get_instance().store_DS_query_result( Constants.DM_ALL_GENEALIASES, </div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                                                          <span class="stringliteral">&#39;query( GeneAlias ).all()&#39;</span> )</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        DataManager.get_instance().store_DS_query_result( Constants.DM_ALL_GENESFROMALIASES, </div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                                          <span class="stringliteral">&#39;query( UTGeneFromAlias ).all()&#39;</span> )</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        DataManager.get_instance().store_DS_query_result( Constants.DM_ALL_UTDSTRANSCRIPTGENECONFLICT, </div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                                                          <span class="stringliteral">&#39;query( UTDSTranscriptGeneConflict ).all()&#39;</span> )</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        </div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        <span class="comment"># Create a dictionary that associates to each gene ID</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="comment"># its Gene object and store it into the DataManager</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        all_gene_id_asso = {}</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">for</span> g <span class="keywordflow">in</span> DataManager.get_instance().get_data( Constants.DM_ALL_GENES ).keys():</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            all_gene_id_asso[ g.gene_id ] = [ g ]</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        DataManager.get_instance().store_data( Constants.DM_ALL_GENE_ID_ASSO, all_gene_id_asso )</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        </div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        </div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment"># Create an empty dictionary that will allow to associate to each (symbol, chromosome) </span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="comment"># pair, a unique Gene object or an Exception containing a message to log. This dictionary</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="comment"># will be filled as data insertion is going on. This allows to faster the insertion of</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="comment"># data as the Gene / Exception object is only search once for each (symbol, chromosome) </span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment"># pair that is recorded.</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        DataManager.get_instance().store_data( Constants.DM_ALL_GENE_SYMBOL_ASSO, {} )</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        </div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="comment"># As the data source can eventually be inserted in several times, it is necessary to </span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="comment"># get also the &quot;conflict&quot; symbols that have already been created during the insertion</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="comment"># of the previous data source, and to consider them in this dictionary.</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        all_gene_symbol_asso = DataManager.get_instance().get_data( Constants.DM_ALL_GENE_SYMBOL_ASSO )</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="comment"># Query the database to get all the entry of the Gene table that have the </span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="comment"># &quot;CONFLICT_GENE&quot; prefix in their symbol and record them in the dictionary.</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        all_gene_conflict = SQLManagerDS.get_instance().get_session().query( Gene ).filter( Gene.gene_id.like( Constants.PREFIX_CONFLICT_GENE_TRANSCRIPT + <span class="stringliteral">&#39;%&#39;</span> ) ).all()</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">for</span> gene_conflict <span class="keywordflow">in</span> all_gene_conflict:</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            all_gene_symbol_asso[ ( gene_conflict.gene_id, gene_conflict.chromosome ) ] = gene_conflict</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        SQLManagerDS.get_instance().close_session()</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        </div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        </div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="comment"># Get the highest values of ID for the DSORF, DSTranscript and DSORFTranscriptAsso </span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="comment"># tables and initialize the first autoincrement value at the maximum value + 1 </span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="comment"># (or to 1 if no data have yet been inserted and all three tables are empty). </span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="comment"># This value is stored in the DataManager main dictionary in order to be used </span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="comment"># by the parsers.</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="comment"># NB: One single autoincrement value is set, meaning that the same variable will </span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="comment">#     be incremented of 1 each time a new variable is created either in the DSORF, </span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="comment">#     DSTranscript or DSORFTranscriptAsso table.</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        max_dsorf_id = SQLManagerDS.get_instance().get_session().query( func.max( DSORF.id ) ).one()[ 0 ]</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        max_dstranscript_id = SQLManagerDS.get_instance().get_session().query( func.max( DSTranscript.id ) ).one()[ 0 ]</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        max_dsota_id = SQLManagerDS.get_instance().get_session().query( func.max( DSORFTranscriptAsso.id ) ).one()[ 0 ]</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        SQLManagerDS.get_instance().close_session()</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        </div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        <span class="keywordflow">if</span> ( max_dsorf_id, max_dstranscript_id, max_dsota_id ) != ( <span class="keywordtype">None</span>, <span class="keywordtype">None</span>, <span class="keywordtype">None</span> ):</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            autoincrement = max( max_dsorf_id, max_dstranscript_id, max_dsota_id ) + 1</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            autoincrement = 1</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        </div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        DataManager.get_instance().store_data( Constants.DM_AUTOINCREMENT, autoincrement )</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;          </div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <span class="comment"># Parse and insert the data</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">if</span> self.source_order:</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            </div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            Logger.get_instance().info( <span class="stringliteral">&#39;Starting the insertion of data.&#39;</span> )</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            </div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keywordflow">if</span> ( len( self.source_order ) &gt; 1 ):</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                Logger.get_instance().debug( <span class="stringliteral">&#39;InsertionStrategy().execute(): The data sources&#39;</span> +</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                                             <span class="stringliteral">&#39; will be parsed and inserted in the following order: &#39;</span> + </div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                                             <span class="stringliteral">&#39;, &#39;</span>.join( self.source_order ) + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        </div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        </div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">for</span> data_source <span class="keywordflow">in</span> self.source_order:</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                    </div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;            <span class="comment"># Get the corresponding data path</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            data_path = self.source_dict.get( data_source )</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                    </div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            <span class="comment"># Instantiate the ParserWrapper</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                parser_wrapper = ParserWrapper( data_source = data_source, </div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                                                data_path = data_path )</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                Logger.get_instance().error( <span class="stringliteral">&#39;InsertionStrategy().execute(): An error occurred trying&#39;</span> +</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                                             <span class="stringliteral">&#39; to instantiate the ParserWrapper for &#39;</span> + data_source + <span class="stringliteral">&#39;\n&#39;</span> + </div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                                             str( e ) + <span class="stringliteral">&#39;\n Hence data from this source will not be&#39;</span> +</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                                             <span class="stringliteral">&#39; inserted in the database.&#39;</span> +</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                                             <span class="stringliteral">&#39; Error code: &#39;</span> + LogCodes.ERR_PARS_PARSER + <span class="stringliteral">&#39;.&#39;</span>,</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                             ex = <span class="keyword">False</span> )</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            </div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                <span class="comment"># Execute the parsing and insertion of data</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                Logger.get_instance().info( <span class="stringliteral">&#39;Starting the parsing and insertion of the data from &#39;</span> + </div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                            data_source + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                </div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                <span class="comment"># Parse the data source</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                Logger.get_instance().debug( <span class="stringliteral">&#39;Starting the parsing of the data from &#39;</span> + data_source + <span class="stringliteral">&#39;.&#39;</span> )</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                <span class="keywordflow">try</span>:</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                    objects_to_insert = parser_wrapper.execute()</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <span class="keywordflow">except</span> InsertException <span class="keyword">as</span> e:</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                    Logger.get_instance().info( e.get_message() )</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                    Logger.get_instance().error( <span class="stringliteral">&#39;InsertionStrategy.execute(): An error occurred trying to&#39;</span> +</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                                                 <span class="stringliteral">&#39; parse the data from &#39;</span> + data_source + <span class="stringliteral">&#39;: &#39;</span> + str( e ) + </div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                                                 <span class="stringliteral">&#39;\n Hence the data from this source will not be inserted&#39;</span> +</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                                                 <span class="stringliteral">&#39; in the database.&#39;</span> +</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                                                 <span class="stringliteral">&#39;\n Error code: &#39;</span> + LogCodes.ERR_PARS_PARSING + <span class="stringliteral">&#39;.&#39;</span>,</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                                                 ex = <span class="keyword">False</span> )</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                <span class="keywordflow">else</span>:                    </div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                    <span class="comment"># Insert the data</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                    </div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                        self.batch_insert_to_db( objects_to_insert = objects_to_insert, </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                                                 source = data_source )</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                    <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                        Logger.get_instance().error( <span class="stringliteral">&#39;InsertionStrategy.execute(): An error occurred trying to&#39;</span> +</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                                     <span class="stringliteral">&#39; insert the data from &#39;</span> + data_source + <span class="stringliteral">&#39;: &#39;</span> + </div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                                                     str( e ) + <span class="stringliteral">&#39;\n Hence the data from this source will&#39;</span> +</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                                     <span class="stringliteral">&#39; not be inserted in the database.&#39;</span> +</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                                     <span class="stringliteral">&#39;\n Error code: &#39;</span> + LogCodes.ERR_SQL_SESSION + <span class="stringliteral">&#39;.&#39;</span>,</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                                                     ex = <span class="keyword">False</span> )</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        </div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="comment"># Remove from the Gene table all the &quot;conflict&quot; genes without children in the </span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="comment"># DSTranscript table (such Gene entries may have been created during the insertion </span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment"># but no longer used because other genes have been added to the list after the </span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="comment"># &#39;CONFLICT_&#39; prefix)</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        all_gene_conflict_wo_child_query = SQLManagerDS.get_instance().get_session().query( Gene ).filter( </div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                                                                                            Gene.gene_id.like( Constants.PREFIX_CONFLICT_GENE_TRANSCRIPT + <span class="stringliteral">&#39;%&#39;</span> ),</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                                                                                                            Gene.DSTranscript_list == <span class="keywordtype">None</span> </div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                                                                                                          )</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        all_gene_conflict_wo_child_count = all_gene_conflict_wo_child_query.count()</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        </div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">if</span> ( all_gene_conflict_wo_child_count != 0 ):</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            Logger.get_instance().debug( <span class="stringliteral">&#39;Removing from the Gene table all the &quot;conflict&quot; entries that&#39;</span> +</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                         <span class="stringliteral">&#39; have been created during the insertion but have no longer any&#39;</span> +</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                                         <span class="stringliteral">&#39; children in the DSTranscript table (&#39;</span> + </div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                                         str( all_gene_conflict_wo_child_count ) + <span class="stringliteral">&#39; entries will be deleted).&#39;</span> +</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                                         <span class="stringliteral">&#39; Please see the documentation for more information.&#39;</span> )</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            </div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            entries_to_delete_str = <span class="stringliteral">&#39;, &#39;</span>.join( [ g.gene_id <span class="keywordflow">for</span> g <span class="keywordflow">in</span> all_gene_conflict_wo_child_query.all() ] )</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                all_gene_conflict_wo_child_query.delete( synchronize_session = <span class="stringliteral">&#39;fetch&#39;</span> )</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                SQLManagerDS.get_instance().commit()</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">except</span> Exception <span class="keyword">as</span> e:</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;InsertionStrategy.execute(): An error occurred trying to&#39;</span> +</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                                           <span class="stringliteral">&#39; remove the following Gene entries from the session&#39;</span> +</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                                           <span class="stringliteral">&#39; and to commit changes: &#39;</span> + entries_to_delete_str + <span class="stringliteral">&#39;.&#39;</span>, e )</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        </div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="comment"># Log the end of the insertion</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">if</span> self.source_order:</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            Logger.get_instance().info( <span class="stringliteral">&#39;The insertion of data has finished.&#39;</span> )  </div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            </div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            </div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<a id="a0fc43a0ce0ec2057a3b12e3856e4ef16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fc43a0ce0ec2057a3b12e3856e4ef16">&#9670;&nbsp;</a></span>parse_config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def fr.tagc.uorf.core.execution.InsertionStrategy.InsertionStrategy.parse_config </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<h2>parse_config </h2>
<p>Parse the config file to retrieve required information.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">DenCellORFException</td><td>When the order of insertion of the gene list or of the data source contains files for which there is no path provided. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">def </span>parse_config( self ):</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="comment"># Read the configfile</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        config = ConfigParser.ConfigParser()</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        config.optionxform = <span class="keyword">lambda</span> option: option</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        config.read( self.configfile )</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        </div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="comment"># Set a dictionary of reference gene lists</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        self.genelists_dict = {}</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        self.genelist_order = []</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        </div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">if</span> config.has_section( Constants.CONFIG_SECTION_GENE_LIST ):</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            </div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">for</span> genelist <span class="keywordflow">in</span> config.items( Constants.CONFIG_SECTION_GENE_LIST ):</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                self.genelists_dict[ genelist[ 0 ] ] = genelist[ 1 ]</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        </div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="comment"># If the gene list is expected to be inserted in a precise order, get it</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keywordflow">if</span> ( config.has_section( Constants.CONFIG_SECTION_GENE_LIST_ORDER_OF_INSERTION )</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                 <span class="keywordflow">and</span> config.has_option( Constants.CONFIG_SECTION_GENE_LIST_ORDER_OF_INSERTION, Constants.CONFIG_SECTION_GENE_LIST_ORDER_OF_INSERTION_ITEM_ORDER )</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                 <span class="keywordflow">and</span> config.get( Constants.CONFIG_SECTION_GENE_LIST_ORDER_OF_INSERTION, Constants.CONFIG_SECTION_GENE_LIST_ORDER_OF_INSERTION_ITEM_ORDER ) <span class="keywordflow">not</span> <span class="keywordflow">in</span> [ <span class="stringliteral">&#39;&#39;</span>, [], <span class="stringliteral">&#39;NA&#39;</span> ]):</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                </div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                self.genelist_order = config.get( Constants.CONFIG_SECTION_GENE_LIST_ORDER_OF_INSERTION, </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                                                  Constants.CONFIG_SECTION_GENE_LIST_ORDER_OF_INSERTION_ITEM_ORDER )</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="comment"># Convert the string into a list</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                self.genelist_order = self.genelist_order.replace( <span class="stringliteral">&#39; &#39;</span>,<span class="stringliteral">&#39;&#39;</span> ).split( <span class="stringliteral">&#39;,&#39;</span> )</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                </div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="comment"># Make sure all the gene lists provided in this list are well provided </span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                <span class="comment"># in the data source section. Raise an exception otherwise.</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                <span class="keywordflow">if</span> ( <span class="keywordflow">not</span> all( elt <span class="keywordflow">in</span> self.genelists_dict.keys() <span class="keywordflow">for</span> elt <span class="keywordflow">in</span> self.genelist_order ) ):</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;InsertionStrategy.parse_config(): The order of insertion&#39;</span> +</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                                               <span class="stringliteral">&#39; of the gene lists provided in the configfile (&#39;</span> + </div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                                               str( self.genelist_order ) + <span class="stringliteral">&#39;) contains gene lists&#39;</span> +</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                                               <span class="stringliteral">&#39; for which there is no path provided.&#39;</span> )</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    </div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="keywordflow">elif</span> self.genelists_dict:</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                Logger.get_instance().info( <span class="stringliteral">&#39;The gene lists will not be parsed and inserted in a&#39;</span> +</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                                            <span class="stringliteral">&#39; particular order as no order of insertion has been provided&#39;</span> +</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                            <span class="stringliteral">&#39; in the config file.&#39;</span> )</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                </div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <span class="comment"># Get the order in which the gene lists have to be parsed and inserted</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            self.genelist_order += [ gl <span class="keywordflow">for</span> gl <span class="keywordflow">in</span> self.genelists_dict.keys() <span class="keywordflow">if</span> ( gl <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.genelist_order ) ]</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        </div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        </div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="comment"># Set a dictionary of data sources</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        self.source_dict = {}</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        self.source_order = []</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        </div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">if</span> config.has_section( Constants.CONFIG_SECTION_DATASOURCE ):</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            </div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <span class="keywordflow">for</span> datasource <span class="keywordflow">in</span> config.items( Constants.CONFIG_SECTION_DATASOURCE ):</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                self.source_dict[ datasource[ 0 ] ] = datasource[ 1 ]</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        </div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="comment"># If the data is expected to be inserted in the precise order, get it</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordflow">if</span> ( config.has_section( Constants.CONFIG_SECTION_DATA_ORDER_OF_INSERTION)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                 <span class="keywordflow">and</span> config.has_option( Constants.CONFIG_SECTION_DATA_ORDER_OF_INSERTION, Constants.CONFIG_SECTION_ORDER_OF_INSERTION_ITEM_ORDER )</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                 <span class="keywordflow">and</span> config.get( Constants.CONFIG_SECTION_DATA_ORDER_OF_INSERTION, Constants.CONFIG_SECTION_ORDER_OF_INSERTION_ITEM_ORDER ) <span class="keywordflow">not</span> <span class="keywordflow">in</span> [ <span class="stringliteral">&#39;&#39;</span>, [], <span class="stringliteral">&#39;NA&#39;</span> ]):</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                </div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                self.source_order = config.get( Constants.CONFIG_SECTION_DATA_ORDER_OF_INSERTION, </div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                                Constants.CONFIG_SECTION_ORDER_OF_INSERTION_ITEM_ORDER )</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                <span class="comment"># Convert the string into a list</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                self.source_order = self.source_order.replace( <span class="stringliteral">&#39; &#39;</span>,<span class="stringliteral">&#39;&#39;</span> ).split( <span class="stringliteral">&#39;,&#39;</span> )</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                </div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                <span class="comment"># Make sure all the sources provided in this list are well provided </span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <span class="comment"># in the data source section. Raise an exception otherwise.</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> all( elt <span class="keywordflow">in</span> self.source_dict.keys() <span class="keywordflow">for</span> elt <span class="keywordflow">in</span> self.source_order ):</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                    <span class="keywordflow">raise</span> DenCellORFException( <span class="stringliteral">&#39;InsertionStrategy.parse_config(): The order of insertion&#39;</span> +</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                                               <span class="stringliteral">&#39; of data provided in the configfile (&#39;</span> + </div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                               str( self.source_order ) + <span class="stringliteral">&#39;) contains data sources&#39;</span> +</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                                               <span class="stringliteral">&#39; for which there is no path provided.&#39;</span> )</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                </div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">elif</span> self.source_dict:</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                Logger.get_instance().info( <span class="stringliteral">&#39;Data sources will not be parsed and inserted in a&#39;</span> +</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                                            <span class="stringliteral">&#39; particular order as no order of insertion has been provided&#39;</span> +</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                            <span class="stringliteral">&#39; in the config file.&#39;</span> )</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                </div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="comment"># Get the order in which the data sources have to be parsed and inserted</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            self.source_order += [ ds <span class="keywordflow">for</span> ds <span class="keywordflow">in</span> self.source_dict.keys() <span class="keywordflow">if</span> ( ds <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.source_order ) ]</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            </div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            </div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div></div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/mnt/NAS7/Workspace/choteaus/tagc-uorf/project/01_ORF_datafreeze/06_src/fr/tagc/uorf/core/execution/InsertionStrategy.py</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
